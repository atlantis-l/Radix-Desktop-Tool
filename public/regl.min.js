(function (da, ea) {
  "object" === typeof exports && "undefined" !== typeof module
    ? (module.exports = ea())
    : "function" === typeof define && define.amd
      ? define(ea)
      : (da.createREGL = ea());
})(this, function () {
  function da(a, b) {
    this.id = vb++;
    this.type = a;
    this.data = b;
  }
  function ea(a) {
    if (0 === a.length) return [];
    var b = a.charAt(0),
      c = a.charAt(a.length - 1);
    if (1 < a.length && b === c && ('"' === b || "'" === b))
      return [
        '"' +
          a
            .substr(1, a.length - 2)
            .replace(/\\/g, "\\\\")
            .replace(/"/g, '\\"') +
          '"',
      ];
    if ((b = /\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a)))
      return ea(a.substr(0, b.index))
        .concat(ea(b[1]))
        .concat(ea(a.substr(b.index + b[0].length)));
    b = a.split(".");
    if (1 === b.length)
      return ['"' + a.replace(/\\/g, "\\\\").replace(/"/g, '\\"') + '"'];
    a = [];
    for (c = 0; c < b.length; ++c) a = a.concat(ea(b[c]));
    return a;
  }
  function Wa(a) {
    return "[" + ea(a).join("][") + "]";
  }
  function wb() {
    var a = { "": 0 },
      b = [""];
    return {
      id: function (c) {
        var d = a[c];
        if (d) return d;
        d = a[c] = b.length;
        b.push(c);
        return d;
      },
      str: function (a) {
        return b[a];
      },
    };
  }
  function xb(a, b, c) {
    function d() {
      var b = window.innerWidth,
        d = window.innerHeight;
      a !== document.body &&
        ((d = a.getBoundingClientRect()),
        (b = d.right - d.left),
        (d = d.bottom - d.top));
      f.width = c * b;
      f.height = c * d;
      A(f.style, { width: b + "px", height: d + "px" });
    }
    var f = document.createElement("canvas");
    A(f.style, { border: 0, margin: 0, padding: 0, top: 0, left: 0 });
    a.appendChild(f);
    a === document.body &&
      ((f.style.position = "absolute"), A(a.style, { margin: 0, padding: 0 }));
    window.addEventListener("resize", d, !1);
    d();
    return {
      canvas: f,
      onDestroy: function () {
        window.removeEventListener("resize", d);
        a.removeChild(f);
      },
    };
  }
  function yb(a, b) {
    function c(c) {
      try {
        return a.getContext(c, b);
      } catch (f) {
        return null;
      }
    }
    return c("webgl") || c("experimental-webgl") || c("webgl-experimental");
  }
  function Xa(a) {
    return "string" === typeof a ? a.split() : a;
  }
  function Ya(a) {
    return "string" === typeof a ? document.querySelector(a) : a;
  }
  function zb(a) {
    var b = a || {},
      c,
      d,
      f,
      k;
    a = {};
    var p = [],
      h = [],
      g = "undefined" === typeof window ? 1 : window.devicePixelRatio,
      r = !1,
      v = function (a) {},
      l = function () {};
    "string" === typeof b
      ? (c = document.querySelector(b))
      : "object" === typeof b &&
        ("string" === typeof b.nodeName &&
        "function" === typeof b.appendChild &&
        "function" === typeof b.getBoundingClientRect
          ? (c = b)
          : "function" === typeof b.drawArrays ||
              "function" === typeof b.drawElements
            ? ((k = b), (f = k.canvas))
            : ("gl" in b
                ? (k = b.gl)
                : "canvas" in b
                  ? (f = Ya(b.canvas))
                  : "container" in b && (d = Ya(b.container)),
              "attributes" in b && (a = b.attributes),
              "extensions" in b && (p = Xa(b.extensions)),
              "optionalExtensions" in b && (h = Xa(b.optionalExtensions)),
              "onDone" in b && (v = b.onDone),
              "profile" in b && (r = !!b.profile),
              "pixelRatio" in b && (g = +b.pixelRatio)));
    c && ("canvas" === c.nodeName.toLowerCase() ? (f = c) : (d = c));
    if (!k) {
      if (!f) {
        c = xb(d || document.body, v, g);
        if (!c) return null;
        f = c.canvas;
        l = c.onDestroy;
      }
      k = yb(f, a);
    }
    return k
      ? {
          gl: k,
          canvas: f,
          container: d,
          extensions: p,
          optionalExtensions: h,
          pixelRatio: g,
          profile: r,
          onDone: v,
          onDestroy: l,
        }
      : (l(),
        v(
          "webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org",
        ),
        null);
  }
  function Ab(a, b) {
    function c(b) {
      b = b.toLowerCase();
      var c;
      try {
        c = d[b] = a.getExtension(b);
      } catch (g) {}
      return !!c;
    }
    for (var d = {}, f = 0; f < b.extensions.length; ++f) {
      var k = b.extensions[f];
      if (!c(k))
        return (
          b.onDestroy(),
          b.onDone(
            '"' +
              k +
              '" extension is not supported by the current WebGL context, try upgrading your system or a different browser',
          ),
          null
        );
    }
    b.optionalExtensions.forEach(c);
    return {
      extensions: d,
      restore: function () {
        Object.keys(d).forEach(function (a) {
          if (!c(a)) throw Error("(regl): error restoring extension " + a);
        });
      },
    };
  }
  function ja(a) {
    return (
      !!a &&
      "object" === typeof a &&
      Array.isArray(a.shape) &&
      Array.isArray(a.stride) &&
      "number" === typeof a.offset &&
      a.shape.length === a.stride.length &&
      (Array.isArray(a.data) || O(a.data))
    );
  }
  function J(a, b) {
    for (var c = Array(a), d = 0; d < a; ++d) c[d] = b(d);
    return c;
  }
  function Za(a) {
    var b, c;
    b = (65535 < a) << 4;
    a >>>= b;
    c = (255 < a) << 3;
    a >>>= c;
    b |= c;
    c = (15 < a) << 2;
    a >>>= c;
    b |= c;
    c = (3 < a) << 1;
    return b | c | ((a >>> c) >> 1);
  }
  function fa(a) {
    a: {
      for (var b = 16; 268435456 >= b; b *= 16)
        if (a <= b) {
          a = b;
          break a;
        }
      a = 0;
    }
    b = $a[Za(a) >> 2];
    return 0 < b.length ? b.pop() : new ArrayBuffer(a);
  }
  function ab(a) {
    $a[Za(a.byteLength) >> 2].push(a);
  }
  function bb(a, b, c, d, f, k) {
    for (var p = 0; p < b; ++p)
      for (var h = a[p], g = 0; g < c; ++g)
        for (var r = h[g], v = 0; v < d; ++v) f[k++] = r[v];
  }
  function cb(a, b, c, d, f) {
    for (var k = 1, p = c + 1; p < b.length; ++p) k *= b[p];
    var h = b[c];
    if (4 === b.length - c) {
      var g = b[c + 1],
        r = b[c + 2];
      b = b[c + 3];
      for (p = 0; p < h; ++p) bb(a[p], g, r, b, d, f), (f += k);
    } else for (p = 0; p < h; ++p) cb(a[p], b, c + 1, d, f), (f += k);
  }
  function Ha(a) {
    return Ea[Object.prototype.toString.call(a)] | 0;
  }
  function db(a, b) {
    for (var c = 0; c < b.length; ++c) a[c] = b[c];
  }
  function eb(a, b, c, d, f, k, p) {
    for (var h = 0, g = 0; g < c; ++g)
      for (var r = 0; r < d; ++r) a[h++] = b[f * g + k * r + p];
  }
  function Bb(a, b, c) {
    function d(b) {
      this.id = h++;
      this.buffer = a.createBuffer();
      this.type = b;
      this.usage = 35044;
      this.byteLength = 0;
      this.dimension = 1;
      this.dtype = 5121;
      this.persistentData = null;
      c.profile && (this.stats = { size: 0 });
    }
    function f(b, c, d) {
      b.byteLength = c.byteLength;
      a.bufferData(b.type, c, d);
    }
    function k(a, b, c, d, e, n) {
      a.usage = c;
      if (Array.isArray(b)) {
        if (((a.dtype = d || 5126), 0 < b.length))
          if (Array.isArray(b[0])) {
            e = fb(b);
            for (var D = (d = 1); D < e.length; ++D) d *= e[D];
            a.dimension = d;
            b = Pa(b, e, a.dtype);
            f(a, b, c);
            n ? (a.persistentData = b) : x.freeType(b);
          } else
            "number" === typeof b[0]
              ? ((a.dimension = e),
                (e = x.allocType(a.dtype, b.length)),
                db(e, b),
                f(a, e, c),
                n ? (a.persistentData = e) : x.freeType(e))
              : O(b[0]) &&
                ((a.dimension = b[0].length),
                (a.dtype = d || Ha(b[0]) || 5126),
                (b = Pa(b, [b.length, b[0].length], a.dtype)),
                f(a, b, c),
                n ? (a.persistentData = b) : x.freeType(b));
      } else if (O(b))
        (a.dtype = d || Ha(b)),
          (a.dimension = e),
          f(a, b, c),
          n && (a.persistentData = new Uint8Array(new Uint8Array(b.buffer)));
      else if (ja(b)) {
        e = b.shape;
        var g = b.stride,
          D = b.offset,
          t = 0,
          k = 0,
          p = 0,
          r = 0;
        1 === e.length
          ? ((t = e[0]), (k = 1), (p = g[0]), (r = 0))
          : 2 === e.length && ((t = e[0]), (k = e[1]), (p = g[0]), (r = g[1]));
        a.dtype = d || Ha(b.data) || 5126;
        a.dimension = k;
        e = x.allocType(a.dtype, t * k);
        eb(e, b.data, t, k, p, r, D);
        f(a, e, c);
        n ? (a.persistentData = e) : x.freeType(e);
      }
    }
    function p(c) {
      b.bufferCount--;
      a.deleteBuffer(c.buffer);
      c.buffer = null;
      delete g[c.id];
    }
    var h = 0,
      g = {};
    d.prototype.bind = function () {
      a.bindBuffer(this.type, this.buffer);
    };
    d.prototype.destroy = function () {
      p(this);
    };
    var r = [];
    c.profile &&
      (b.getTotalBufferSize = function () {
        var a = 0;
        Object.keys(g).forEach(function (b) {
          a += g[b].stats.size;
        });
        return a;
      });
    return {
      create: function (f, l, u, m) {
        function e(b) {
          var d = 35044,
            g = null,
            l = 0,
            f = 0,
            u = 1;
          Array.isArray(b) || O(b) || ja(b)
            ? (g = b)
            : "number" === typeof b
              ? (l = b | 0)
              : b &&
                ("data" in b && (g = b.data),
                "usage" in b && (d = hb[b.usage]),
                "type" in b && (f = Qa[b.type]),
                "dimension" in b && (u = b.dimension | 0),
                "length" in b && (l = b.length | 0));
          n.bind();
          g
            ? k(n, g, d, f, u, m)
            : (a.bufferData(n.type, l, d),
              (n.dtype = f || 5121),
              (n.usage = d),
              (n.dimension = u),
              (n.byteLength = l));
          c.profile && (n.stats.size = n.byteLength * ga[n.dtype]);
          return e;
        }
        b.bufferCount++;
        var n = new d(l);
        g[n.id] = n;
        u || e(f);
        e._reglType = "buffer";
        e._buffer = n;
        e.subdata = function (b, c) {
          var d = (c || 0) | 0,
            g;
          n.bind();
          if (Array.isArray(b)) {
            if (0 < b.length)
              if ("number" === typeof b[0]) {
                var l = x.allocType(n.dtype, b.length);
                db(l, b);
                a.bufferSubData(n.type, d, l);
                x.freeType(l);
              } else if (Array.isArray(b[0]) || O(b[0]))
                (g = fb(b)),
                  (l = Pa(b, g, n.dtype)),
                  a.bufferSubData(n.type, d, l),
                  x.freeType(l);
          } else if (O(b)) a.bufferSubData(n.type, d, b);
          else if (ja(b)) {
            g = b.shape;
            var f = b.stride,
              m = (l = 0),
              u = 0,
              k = 0;
            1 === g.length
              ? ((l = g[0]), (m = 1), (u = f[0]), (k = 0))
              : 2 === g.length &&
                ((l = g[0]), (m = g[1]), (u = f[0]), (k = f[1]));
            g = Array.isArray(b.data) ? n.dtype : Ha(b.data);
            g = x.allocType(g, l * m);
            eb(g, b.data, l, m, u, k, b.offset);
            a.bufferSubData(n.type, d, g);
            x.freeType(g);
          }
          return e;
        };
        c.profile && (e.stats = n.stats);
        e.destroy = function () {
          p(n);
        };
        return e;
      },
      createStream: function (a, b) {
        var c = r.pop();
        c || (c = new d(a));
        c.bind();
        k(c, b, 35040, 0, 1, !1);
        return c;
      },
      destroyStream: function (a) {
        r.push(a);
      },
      clear: function () {
        H(g).forEach(p);
        r.forEach(p);
      },
      getBuffer: function (a) {
        return a && a._buffer instanceof d ? a._buffer : null;
      },
      restore: function () {
        H(g).forEach(function (b) {
          b.buffer = a.createBuffer();
          a.bindBuffer(b.type, b.buffer);
          a.bufferData(b.type, b.persistentData || b.byteLength, b.usage);
        });
      },
      _initBuffer: k,
    };
  }
  function Cb(a, b, c, d) {
    function f(a) {
      this.id = g++;
      h[this.id] = this;
      this.buffer = a;
      this.primType = 4;
      this.type = this.vertCount = 0;
    }
    function k(d, g, f, e, n, k, w) {
      d.buffer.bind();
      if (g) {
        var t = w;
        w ||
          (O(g) && (!ja(g) || O(g.data))) ||
          (t = b.oes_element_index_uint ? 5125 : 5123);
        c._initBuffer(d.buffer, g, f, t, 3);
      } else
        a.bufferData(34963, k, f),
          (d.buffer.dtype = t || 5121),
          (d.buffer.usage = f),
          (d.buffer.dimension = 3),
          (d.buffer.byteLength = k);
      t = w;
      if (!w) {
        switch (d.buffer.dtype) {
          case 5121:
          case 5120:
            t = 5121;
            break;
          case 5123:
          case 5122:
            t = 5123;
            break;
          case 5125:
          case 5124:
            t = 5125;
        }
        d.buffer.dtype = t;
      }
      d.type = t;
      g = n;
      0 > g &&
        ((g = d.buffer.byteLength),
        5123 === t ? (g >>= 1) : 5125 === t && (g >>= 2));
      d.vertCount = g;
      g = e;
      0 > e &&
        ((g = 4),
        (e = d.buffer.dimension),
        1 === e && (g = 0),
        2 === e && (g = 1),
        3 === e && (g = 4));
      d.primType = g;
    }
    function p(a) {
      d.elementsCount--;
      delete h[a.id];
      a.buffer.destroy();
      a.buffer = null;
    }
    var h = {},
      g = 0,
      r = { uint8: 5121, uint16: 5123 };
    b.oes_element_index_uint && (r.uint32 = 5125);
    f.prototype.bind = function () {
      this.buffer.bind();
    };
    var v = [];
    return {
      create: function (a, b) {
        function g(a) {
          if (a)
            if ("number" === typeof a)
              e(a), (n.primType = 4), (n.vertCount = a | 0), (n.type = 5121);
            else {
              var b = null,
                c = 35044,
                d = -1,
                f = -1,
                l = 0,
                p = 0;
              if (Array.isArray(a) || O(a) || ja(a)) b = a;
              else if (
                ("data" in a && (b = a.data),
                "usage" in a && (c = hb[a.usage]),
                "primitive" in a && (d = Ra[a.primitive]),
                "count" in a && (f = a.count | 0),
                "type" in a && (p = r[a.type]),
                "length" in a)
              )
                l = a.length | 0;
              else if (((l = f), 5123 === p || 5122 === p)) l *= 2;
              else if (5125 === p || 5124 === p) l *= 4;
              k(n, b, c, d, f, l, p);
            }
          else e(), (n.primType = 4), (n.vertCount = 0), (n.type = 5121);
          return g;
        }
        var e = c.create(null, 34963, !0),
          n = new f(e._buffer);
        d.elementsCount++;
        g(a);
        g._reglType = "elements";
        g._elements = n;
        g.subdata = function (a, b) {
          e.subdata(a, b);
          return g;
        };
        g.destroy = function () {
          p(n);
        };
        return g;
      },
      createStream: function (a) {
        var b = v.pop();
        b || (b = new f(c.create(null, 34963, !0, !1)._buffer));
        k(b, a, 35040, -1, -1, 0, 0);
        return b;
      },
      destroyStream: function (a) {
        v.push(a);
      },
      getElements: function (a) {
        return "function" === typeof a && a._elements instanceof f
          ? a._elements
          : null;
      },
      clear: function () {
        H(h).forEach(p);
      },
    };
  }
  function ib(a) {
    for (var b = x.allocType(5123, a.length), c = 0; c < a.length; ++c)
      if (isNaN(a[c])) b[c] = 65535;
      else if (Infinity === a[c]) b[c] = 31744;
      else if (-Infinity === a[c]) b[c] = 64512;
      else {
        jb[0] = a[c];
        var d = Db[0],
          f = (d >>> 31) << 15,
          k = ((d << 1) >>> 24) - 127,
          d = (d >> 13) & 1023;
        b[c] =
          -24 > k
            ? f
            : -14 > k
              ? f + ((d + 1024) >> (-14 - k))
              : 15 < k
                ? f + 31744
                : f + ((k + 15) << 10) + d;
      }
    return b;
  }
  function na(a) {
    return Array.isArray(a) || O(a);
  }
  function kb(a) {
    return Array.isArray(a) && (0 === a.length || "number" === typeof a[0]);
  }
  function lb(a) {
    return Array.isArray(a) && 0 !== a.length && na(a[0]) ? !0 : !1;
  }
  function oa(a) {
    return Object.prototype.toString.call(a);
  }
  function Sa(a) {
    if (!a) return !1;
    var b = oa(a);
    return 0 <= Eb.indexOf(b) ? !0 : kb(a) || lb(a) || ja(a);
  }
  function mb(a, b) {
    36193 === a.type ? ((a.data = ib(b)), x.freeType(b)) : (a.data = b);
  }
  function Ia(a, b, c, d, f, k) {
    a = "undefined" !== typeof C[a] ? C[a] : R[a] * za[b];
    k && (a *= 6);
    if (f) {
      for (d = 0; 1 <= c; ) (d += a * c * c), (c /= 2);
      return d;
    }
    return a * c * d;
  }
  function Fb(a, b, c, d, f, k, p) {
    function h() {
      this.format = this.internalformat = 6408;
      this.type = 5121;
      this.flipY = this.premultiplyAlpha = this.compressed = !1;
      this.unpackAlignment = 1;
      this.channels = this.height = this.width = this.colorSpace = 0;
    }
    function g(a, b) {
      a.internalformat = b.internalformat;
      a.format = b.format;
      a.type = b.type;
      a.compressed = b.compressed;
      a.premultiplyAlpha = b.premultiplyAlpha;
      a.flipY = b.flipY;
      a.unpackAlignment = b.unpackAlignment;
      a.colorSpace = b.colorSpace;
      a.width = b.width;
      a.height = b.height;
      a.channels = b.channels;
    }
    function r(a, b) {
      if ("object" === typeof b && b) {
        "premultiplyAlpha" in b && (a.premultiplyAlpha = b.premultiplyAlpha);
        "flipY" in b && (a.flipY = b.flipY);
        "alignment" in b && (a.unpackAlignment = b.alignment);
        "colorSpace" in b && (a.colorSpace = ua[b.colorSpace]);
        "type" in b && (a.type = E[b.type]);
        var c = a.width,
          g = a.height,
          e = a.channels,
          d = !1;
        "shape" in b
          ? ((c = b.shape[0]),
            (g = b.shape[1]),
            3 === b.shape.length && ((e = b.shape[2]), (d = !0)))
          : ("radius" in b && (c = g = b.radius),
            "width" in b && (c = b.width),
            "height" in b && (g = b.height),
            "channels" in b && ((e = b.channels), (d = !0)));
        a.width = c | 0;
        a.height = g | 0;
        a.channels = e | 0;
        c = !1;
        "format" in b &&
          ((c = b.format),
          (g = a.internalformat = S[c]),
          (a.format = Gb[g]),
          c in E && !("type" in b) && (a.type = E[c]),
          c in U && (a.compressed = !0),
          (c = !0));
        !d && c
          ? (a.channels = R[a.format])
          : d &&
            !c &&
            a.channels !== Ka[a.format] &&
            (a.format = a.internalformat = Ka[a.channels]);
      }
    }
    function v(b) {
      a.pixelStorei(37440, b.flipY);
      a.pixelStorei(37441, b.premultiplyAlpha);
      a.pixelStorei(37443, b.colorSpace);
      a.pixelStorei(3317, b.unpackAlignment);
    }
    function l() {
      h.call(this);
      this.yOffset = this.xOffset = 0;
      this.data = null;
      this.needsFree = !1;
      this.element = null;
      this.needsCopy = !1;
    }
    function u(a, b) {
      var c = null;
      Sa(b)
        ? (c = b)
        : b &&
          (r(a, b),
          "x" in b && (a.xOffset = b.x | 0),
          "y" in b && (a.yOffset = b.y | 0),
          Sa(b.data) && (c = b.data));
      if (b.copy) {
        var g = f.viewportWidth,
          e = f.viewportHeight;
        a.width = a.width || g - a.xOffset;
        a.height = a.height || e - a.yOffset;
        a.needsCopy = !0;
      } else if (!c)
        (a.width = a.width || 1),
          (a.height = a.height || 1),
          (a.channels = a.channels || 4);
      else if (O(c))
        (a.channels = a.channels || 4),
          (a.data = c),
          "type" in b ||
            5121 !== a.type ||
            (a.type = Ea[Object.prototype.toString.call(c)] | 0);
      else if (kb(c)) {
        a.channels = a.channels || 4;
        g = c;
        e = g.length;
        switch (a.type) {
          case 5121:
          case 5123:
          case 5125:
          case 5126:
            e = x.allocType(a.type, e);
            e.set(g);
            a.data = e;
            break;
          case 36193:
            a.data = ib(g);
        }
        a.alignment = 1;
        a.needsFree = !0;
      } else if (ja(c)) {
        g = c.data;
        Array.isArray(g) ||
          5121 !== a.type ||
          (a.type = Ea[Object.prototype.toString.call(g)] | 0);
        var e = c.shape,
          d = c.stride,
          n,
          l,
          q,
          y;
        3 === e.length ? ((q = e[2]), (y = d[2])) : (y = q = 1);
        n = e[0];
        l = e[1];
        e = d[0];
        d = d[1];
        a.alignment = 1;
        a.width = n;
        a.height = l;
        a.channels = q;
        a.format = a.internalformat = Ka[q];
        a.needsFree = !0;
        n = y;
        c = c.offset;
        q = a.width;
        y = a.height;
        l = a.channels;
        for (
          var K = x.allocType(36193 === a.type ? 5126 : a.type, q * y * l),
            aa = 0,
            va = 0;
          va < y;
          ++va
        )
          for (var wa = 0; wa < q; ++wa)
            for (var ca = 0; ca < l; ++ca)
              K[aa++] = g[e * wa + d * va + n * ca + c];
        mb(a, K);
      } else if (
        "[object HTMLCanvasElement]" === oa(c) ||
        "[object CanvasRenderingContext2D]" === oa(c)
      )
        "[object HTMLCanvasElement]" === oa(c)
          ? (a.element = c)
          : (a.element = c.canvas),
          (a.width = a.element.width),
          (a.height = a.element.height),
          (a.channels = 4);
      else if ("[object HTMLImageElement]" === oa(c))
        (a.element = c),
          (a.width = c.naturalWidth),
          (a.height = c.naturalHeight),
          (a.channels = 4);
      else if ("[object HTMLVideoElement]" === oa(c))
        (a.element = c),
          (a.width = c.videoWidth),
          (a.height = c.videoHeight),
          (a.channels = 4);
      else if (lb(c)) {
        g = a.width || c[0].length;
        e = a.height || c.length;
        d = a.channels;
        d = na(c[0][0]) ? d || c[0][0].length : d || 1;
        n = La.shape(c);
        q = 1;
        for (y = 0; y < n.length; ++y) q *= n[y];
        q = x.allocType(36193 === a.type ? 5126 : a.type, q);
        La.flatten(c, n, "", q);
        mb(a, q);
        a.alignment = 1;
        a.width = g;
        a.height = e;
        a.channels = d;
        a.format = a.internalformat = Ka[d];
        a.needsFree = !0;
      }
    }
    function m(b, c, g, e, f) {
      var n = b.element,
        l = b.data,
        k = b.internalformat,
        q = b.format,
        y = b.type,
        K = b.width,
        aa = b.height;
      v(b);
      n
        ? a.texSubImage2D(c, f, g, e, q, y, n)
        : b.compressed
          ? a.compressedTexSubImage2D(c, f, g, e, k, K, aa, l)
          : b.needsCopy
            ? (d(),
              a.copyTexSubImage2D(c, f, g, e, b.xOffset, b.yOffset, K, aa))
            : a.texSubImage2D(c, f, g, e, K, aa, q, y, l);
    }
    function e() {
      return N.pop() || new l();
    }
    function n(a) {
      a.needsFree && x.freeType(a.data);
      l.call(a);
      N.push(a);
    }
    function D() {
      h.call(this);
      this.genMipmaps = !1;
      this.mipmapHint = 4352;
      this.mipmask = 0;
      this.images = Array(16);
    }
    function w(a, b, c) {
      var g = (a.images[0] = e());
      a.mipmask = 1;
      g.width = a.width = b;
      g.height = a.height = c;
      g.channels = a.channels = 4;
    }
    function t(a, b) {
      var c = null;
      if (Sa(b)) (c = a.images[0] = e()), g(c, a), u(c, b), (a.mipmask = 1);
      else if ((r(a, b), Array.isArray(b.mipmap)))
        for (var d = b.mipmap, f = 0; f < d.length; ++f)
          (c = a.images[f] = e()),
            g(c, a),
            (c.width >>= f),
            (c.height >>= f),
            u(c, d[f]),
            (a.mipmask |= 1 << f);
      else (c = a.images[0] = e()), g(c, a), u(c, b), (a.mipmask = 1);
      g(a, a.images[0]);
    }
    function Z(b, c) {
      for (var g = b.images, e = 0; e < g.length && g[e]; ++e) {
        var f = g[e],
          n = c,
          l = e,
          k = f.element,
          q = f.data,
          y = f.internalformat,
          K = f.format,
          aa = f.type,
          va = f.width,
          wa = f.height;
        v(f);
        k
          ? a.texImage2D(n, l, K, K, aa, k)
          : f.compressed
            ? a.compressedTexImage2D(n, l, y, va, wa, 0, q)
            : f.needsCopy
              ? (d(),
                a.copyTexImage2D(n, l, K, f.xOffset, f.yOffset, va, wa, 0))
              : a.texImage2D(n, l, K, va, wa, 0, K, aa, q);
      }
    }
    function B() {
      var a = nb.pop() || new D();
      h.call(a);
      for (var b = (a.mipmask = 0); 16 > b; ++b) a.images[b] = null;
      return a;
    }
    function gb(a) {
      for (var b = a.images, c = 0; c < b.length; ++c)
        b[c] && n(b[c]), (b[c] = null);
      nb.push(a);
    }
    function C() {
      this.magFilter = this.minFilter = 9728;
      this.wrapT = this.wrapS = 33071;
      this.anisotropic = 1;
      this.genMipmaps = !1;
      this.mipmapHint = 4352;
    }
    function M(a, b) {
      "min" in b &&
        ((a.minFilter = Ta[b.min]),
        0 <= Hb.indexOf(a.minFilter) && (a.genMipmaps = !0));
      "mag" in b && (a.magFilter = T[b.mag]);
      var c = a.wrapS,
        g = a.wrapT;
      if ("wrap" in b) {
        var e = b.wrap;
        "string" === typeof e
          ? (c = g = I[e])
          : Array.isArray(e) && ((c = I[e[0]]), (g = I[e[1]]));
      } else "wrapS" in b && (c = I[b.wrapS]), "wrapT" in b && (g = I[b.wrapT]);
      a.wrapS = c;
      a.wrapT = g;
      "anisotropic" in b && (a.anisotropic = b.anisotropic);
      if ("mipmap" in b) {
        c = !1;
        switch (typeof b.mipmap) {
          case "string":
            a.mipmapHint = sa[b.mipmap];
            c = a.genMipmaps = !0;
            break;
          case "boolean":
            c = a.genMipmaps = b.mipmap;
            break;
          case "object":
            (a.genMipmaps = !1), (c = !0);
        }
        !c || "min" in b || (a.minFilter = 9984);
      }
    }
    function P(c, g) {
      a.texParameteri(g, 10241, c.minFilter);
      a.texParameteri(g, 10240, c.magFilter);
      a.texParameteri(g, 10242, c.wrapS);
      a.texParameteri(g, 10243, c.wrapT);
      b.ext_texture_filter_anisotropic &&
        a.texParameteri(g, 34046, c.anisotropic);
      c.genMipmaps && (a.hint(33170, c.mipmapHint), a.generateMipmap(g));
    }
    function G(b) {
      h.call(this);
      this.mipmask = 0;
      this.internalformat = 6408;
      this.id = xa++;
      this.refCount = 1;
      this.target = b;
      this.texture = a.createTexture();
      this.unit = -1;
      this.bindCount = 0;
      this.texInfo = new C();
      p.profile && (this.stats = { size: 0 });
    }
    function Q(b) {
      a.activeTexture(33984);
      a.bindTexture(b.target, b.texture);
    }
    function Aa() {
      var b = ka[0];
      b ? a.bindTexture(b.target, b.texture) : a.bindTexture(3553, null);
    }
    function z(b) {
      var c = b.texture,
        g = b.unit,
        e = b.target;
      0 <= g &&
        (a.activeTexture(33984 + g), a.bindTexture(e, null), (ka[g] = null));
      a.deleteTexture(c);
      b.texture = null;
      b.params = null;
      b.pixels = null;
      b.refCount = 0;
      delete V[b.id];
      k.textureCount--;
    }
    var sa = { "don't care": 4352, "dont care": 4352, nice: 4354, fast: 4353 },
      I = { repeat: 10497, clamp: 33071, mirror: 33648 },
      T = { nearest: 9728, linear: 9729 },
      Ta = A(
        {
          mipmap: 9987,
          "nearest mipmap nearest": 9984,
          "linear mipmap nearest": 9985,
          "nearest mipmap linear": 9986,
          "linear mipmap linear": 9987,
        },
        T,
      ),
      ua = { none: 0, browser: 37444 },
      E = { uint8: 5121, rgba4: 32819, rgb565: 33635, "rgb5 a1": 32820 },
      S = {
        alpha: 6406,
        luminance: 6409,
        "luminance alpha": 6410,
        rgb: 6407,
        rgba: 6408,
        rgba4: 32854,
        "rgb5 a1": 32855,
        rgb565: 36194,
      },
      U = {};
    b.ext_srgb && ((S.srgb = 35904), (S.srgba = 35906));
    b.oes_texture_float && (E.float32 = E["float"] = 5126);
    b.oes_texture_half_float && (E.float16 = E["half float"] = 36193);
    b.webgl_depth_texture &&
      (A(S, { depth: 6402, "depth stencil": 34041 }),
      A(E, { uint16: 5123, uint32: 5125, "depth stencil": 34042 }));
    b.webgl_compressed_texture_s3tc &&
      A(U, {
        "rgb s3tc dxt1": 33776,
        "rgba s3tc dxt1": 33777,
        "rgba s3tc dxt3": 33778,
        "rgba s3tc dxt5": 33779,
      });
    b.webgl_compressed_texture_atc &&
      A(U, {
        "rgb atc": 35986,
        "rgba atc explicit alpha": 35987,
        "rgba atc interpolated alpha": 34798,
      });
    b.webgl_compressed_texture_pvrtc &&
      A(U, {
        "rgb pvrtc 4bppv1": 35840,
        "rgb pvrtc 2bppv1": 35841,
        "rgba pvrtc 4bppv1": 35842,
        "rgba pvrtc 2bppv1": 35843,
      });
    b.webgl_compressed_texture_etc1 && (U["rgb etc1"] = 36196);
    var Ib = Array.prototype.slice.call(a.getParameter(34467));
    Object.keys(U).forEach(function (a) {
      var b = U[a];
      0 <= Ib.indexOf(b) && (S[a] = b);
    });
    var ba = Object.keys(S);
    c.textureFormats = ba;
    var J = [];
    Object.keys(S).forEach(function (a) {
      J[S[a]] = a;
    });
    var W = [];
    Object.keys(E).forEach(function (a) {
      W[E[a]] = a;
    });
    var la = [];
    Object.keys(T).forEach(function (a) {
      la[T[a]] = a;
    });
    var ya = [];
    Object.keys(Ta).forEach(function (a) {
      ya[Ta[a]] = a;
    });
    var ha = [];
    Object.keys(I).forEach(function (a) {
      ha[I[a]] = a;
    });
    var Gb = ba.reduce(function (a, b) {
        var c = S[b];
        6409 === c ||
        6406 === c ||
        6409 === c ||
        6410 === c ||
        6402 === c ||
        34041 === c
          ? (a[c] = c)
          : 32855 === c || 0 <= b.indexOf("rgba")
            ? (a[c] = 6408)
            : (a[c] = 6407);
        return a;
      }, {}),
      N = [],
      nb = [],
      xa = 0,
      V = {},
      ma = c.maxTextureUnits,
      ka = Array(ma).map(function () {
        return null;
      });
    A(G.prototype, {
      bind: function () {
        this.bindCount += 1;
        var b = this.unit;
        if (0 > b) {
          for (var c = 0; c < ma; ++c) {
            var g = ka[c];
            if (g) {
              if (0 < g.bindCount) continue;
              g.unit = -1;
            }
            ka[c] = this;
            b = c;
            break;
          }
          p.profile && k.maxTextureUnits < b + 1 && (k.maxTextureUnits = b + 1);
          this.unit = b;
          a.activeTexture(33984 + b);
          a.bindTexture(this.target, this.texture);
        }
        return b;
      },
      unbind: function () {
        --this.bindCount;
      },
      decRef: function () {
        0 >= --this.refCount && z(this);
      },
    });
    p.profile &&
      (k.getTotalTextureSize = function () {
        var a = 0;
        Object.keys(V).forEach(function (b) {
          a += V[b].stats.size;
        });
        return a;
      });
    return {
      create2D: function (b, c) {
        function d(a, b) {
          var c = f.texInfo;
          C.call(c);
          var e = B();
          "number" === typeof a
            ? "number" === typeof b
              ? w(e, a | 0, b | 0)
              : w(e, a | 0, a | 0)
            : a
              ? (M(c, a), t(e, a))
              : w(e, 1, 1);
          c.genMipmaps && (e.mipmask = (e.width << 1) - 1);
          f.mipmask = e.mipmask;
          g(f, e);
          f.internalformat = e.internalformat;
          d.width = e.width;
          d.height = e.height;
          Q(f);
          Z(e, 3553);
          P(c, 3553);
          Aa();
          gb(e);
          p.profile &&
            (f.stats.size = Ia(
              f.internalformat,
              f.type,
              e.width,
              e.height,
              c.genMipmaps,
              !1,
            ));
          d.format = J[f.internalformat];
          d.type = W[f.type];
          d.mag = la[c.magFilter];
          d.min = ya[c.minFilter];
          d.wrapS = ha[c.wrapS];
          d.wrapT = ha[c.wrapT];
          return d;
        }
        var f = new G(3553);
        V[f.id] = f;
        k.textureCount++;
        d(b, c);
        d.subimage = function (a, b, c, l) {
          b |= 0;
          c |= 0;
          l |= 0;
          var q = e();
          g(q, f);
          q.width = 0;
          q.height = 0;
          u(q, a);
          q.width = q.width || (f.width >> l) - b;
          q.height = q.height || (f.height >> l) - c;
          Q(f);
          m(q, 3553, b, c, l);
          Aa();
          n(q);
          return d;
        };
        d.resize = function (b, c) {
          var e = b | 0,
            g = c | 0 || e;
          if (e === f.width && g === f.height) return d;
          d.width = f.width = e;
          d.height = f.height = g;
          Q(f);
          for (var q = 0; f.mipmask >> q; ++q)
            a.texImage2D(
              3553,
              q,
              f.format,
              e >> q,
              g >> q,
              0,
              f.format,
              f.type,
              null,
            );
          Aa();
          p.profile &&
            (f.stats.size = Ia(f.internalformat, f.type, e, g, !1, !1));
          return d;
        };
        d._reglType = "texture2d";
        d._texture = f;
        p.profile && (d.stats = f.stats);
        d.destroy = function () {
          f.decRef();
        };
        return d;
      },
      createCube: function (b, c, d, f, l, sa) {
        function z(a, b, c, e, d, f) {
          var F,
            X = h.texInfo;
          C.call(X);
          for (F = 0; 6 > F; ++F) q[F] = B();
          if ("number" === typeof a || !a)
            for (a = a | 0 || 1, F = 0; 6 > F; ++F) w(q[F], a, a);
          else if ("object" === typeof a)
            if (b)
              t(q[0], a),
                t(q[1], b),
                t(q[2], c),
                t(q[3], e),
                t(q[4], d),
                t(q[5], f);
            else if ((M(X, a), r(h, a), "faces" in a))
              for (a = a.faces, F = 0; 6 > F; ++F) g(q[F], h), t(q[F], a[F]);
            else for (F = 0; 6 > F; ++F) t(q[F], a);
          g(h, q[0]);
          h.mipmask = X.genMipmaps ? (q[0].width << 1) - 1 : q[0].mipmask;
          h.internalformat = q[0].internalformat;
          z.width = q[0].width;
          z.height = q[0].height;
          Q(h);
          for (F = 0; 6 > F; ++F) Z(q[F], 34069 + F);
          P(X, 34067);
          Aa();
          p.profile &&
            (h.stats.size = Ia(
              h.internalformat,
              h.type,
              z.width,
              z.height,
              X.genMipmaps,
              !0,
            ));
          z.format = J[h.internalformat];
          z.type = W[h.type];
          z.mag = la[X.magFilter];
          z.min = ya[X.minFilter];
          z.wrapS = ha[X.wrapS];
          z.wrapT = ha[X.wrapT];
          for (F = 0; 6 > F; ++F) gb(q[F]);
          return z;
        }
        var h = new G(34067);
        V[h.id] = h;
        k.cubeCount++;
        var q = Array(6);
        z(b, c, d, f, l, sa);
        z.subimage = function (a, b, c, q, d) {
          c |= 0;
          q |= 0;
          d |= 0;
          var f = e();
          g(f, h);
          f.width = 0;
          f.height = 0;
          u(f, b);
          f.width = f.width || (h.width >> d) - c;
          f.height = f.height || (h.height >> d) - q;
          Q(h);
          m(f, 34069 + a, c, q, d);
          Aa();
          n(f);
          return z;
        };
        z.resize = function (b) {
          b |= 0;
          if (b !== h.width) {
            z.width = h.width = b;
            z.height = h.height = b;
            Q(h);
            for (var c = 0; 6 > c; ++c)
              for (var q = 0; h.mipmask >> q; ++q)
                a.texImage2D(
                  34069 + c,
                  q,
                  h.format,
                  b >> q,
                  b >> q,
                  0,
                  h.format,
                  h.type,
                  null,
                );
            Aa();
            p.profile &&
              (h.stats.size = Ia(
                h.internalformat,
                h.type,
                z.width,
                z.height,
                !1,
                !0,
              ));
            return z;
          }
        };
        z._reglType = "textureCube";
        z._texture = h;
        p.profile && (z.stats = h.stats);
        z.destroy = function () {
          h.decRef();
        };
        return z;
      },
      clear: function () {
        for (var b = 0; b < ma; ++b)
          a.activeTexture(33984 + b), a.bindTexture(3553, null), (ka[b] = null);
        H(V).forEach(z);
        k.cubeCount = 0;
        k.textureCount = 0;
      },
      getTexture: function (a) {
        return null;
      },
      restore: function () {
        H(V).forEach(function (b) {
          b.texture = a.createTexture();
          a.bindTexture(b.target, b.texture);
          for (var c = 0; 32 > c; ++c)
            if (0 !== (b.mipmask & (1 << c)))
              if (3553 === b.target)
                a.texImage2D(
                  3553,
                  c,
                  b.internalformat,
                  b.width >> c,
                  b.height >> c,
                  0,
                  b.internalformat,
                  b.type,
                  null,
                );
              else
                for (var e = 0; 6 > e; ++e)
                  a.texImage2D(
                    34069 + e,
                    c,
                    b.internalformat,
                    b.width >> c,
                    b.height >> c,
                    0,
                    b.internalformat,
                    b.type,
                    null,
                  );
          P(b.texInfo, b.target);
        });
      },
    };
  }
  function Jb(a, b, c, d, f, k) {
    function p(a, b, c) {
      this.target = a;
      this.texture = b;
      this.renderbuffer = c;
      var e = (a = 0);
      b
        ? ((a = b.width), (e = b.height))
        : c && ((a = c.width), (e = c.height));
      this.width = a;
      this.height = e;
    }
    function h(a) {
      a &&
        (a.texture && a.texture._texture.decRef(),
        a.renderbuffer && a.renderbuffer._renderbuffer.decRef());
    }
    function g(a, b, c) {
      a &&
        (a.texture
          ? (a.texture._texture.refCount += 1)
          : (a.renderbuffer._renderbuffer.refCount += 1));
    }
    function r(b, c) {
      c &&
        (c.texture
          ? a.framebufferTexture2D(
              36160,
              b,
              c.target,
              c.texture._texture.texture,
              0,
            )
          : a.framebufferRenderbuffer(
              36160,
              b,
              36161,
              c.renderbuffer._renderbuffer.renderbuffer,
            ));
    }
    function v(a) {
      var b = 3553,
        c = null,
        e = null,
        g = a;
      "object" === typeof a &&
        ((g = a.data), "target" in a && (b = a.target | 0));
      a = g._reglType;
      "texture2d" === a
        ? (c = g)
        : "textureCube" === a
          ? (c = g)
          : "renderbuffer" === a && ((e = g), (b = 36161));
      return new p(b, c, e);
    }
    function l(a, b, c, e, g) {
      if (c)
        return (
          (a = d.create2D({ width: a, height: b, format: e, type: g })),
          (a._texture.refCount = 0),
          new p(3553, a, null)
        );
      a = f.create({ width: a, height: b, format: e });
      a._renderbuffer.refCount = 0;
      return new p(36161, null, a);
    }
    function u(a) {
      return a && (a.texture || a.renderbuffer);
    }
    function m(a, b, c) {
      a &&
        (a.texture
          ? a.texture.resize(b, c)
          : a.renderbuffer && a.renderbuffer.resize(b, c));
    }
    function e() {
      this.id = M++;
      P[this.id] = this;
      this.framebuffer = a.createFramebuffer();
      this.height = this.width = 0;
      this.colorAttachments = [];
      this.depthStencilAttachment =
        this.stencilAttachment =
        this.depthAttachment =
          null;
    }
    function n(a) {
      a.colorAttachments.forEach(h);
      h(a.depthAttachment);
      h(a.stencilAttachment);
      h(a.depthStencilAttachment);
    }
    function D(b) {
      a.deleteFramebuffer(b.framebuffer);
      b.framebuffer = null;
      k.framebufferCount--;
      delete P[b.id];
    }
    function w(b) {
      var e;
      a.bindFramebuffer(36160, b.framebuffer);
      var g = b.colorAttachments;
      for (e = 0; e < g.length; ++e) r(36064 + e, g[e]);
      for (e = g.length; e < c.maxColorAttachments; ++e)
        a.framebufferTexture2D(36160, 36064 + e, 3553, null, 0);
      a.framebufferTexture2D(36160, 33306, 3553, null, 0);
      a.framebufferTexture2D(36160, 36096, 3553, null, 0);
      a.framebufferTexture2D(36160, 36128, 3553, null, 0);
      r(36096, b.depthAttachment);
      r(36128, b.stencilAttachment);
      r(33306, b.depthStencilAttachment);
      a.checkFramebufferStatus(36160);
      a.bindFramebuffer(36160, Z.next);
      Z.cur = Z.next;
      a.getError();
    }
    function t(a, b) {
      function c(a, b) {
        var e,
          f = 0,
          h = 0,
          k = !0,
          m = !0;
        e = null;
        var p = !0,
          t = "rgba",
          r = "uint8",
          D = 1,
          W = null,
          la = null,
          Z = null,
          ha = !1;
        if ("number" === typeof a) (f = a | 0), (h = b | 0 || f);
        else if (a) {
          "shape" in a
            ? ((h = a.shape), (f = h[0]), (h = h[1]))
            : ("radius" in a && (f = h = a.radius),
              "width" in a && (f = a.width),
              "height" in a && (h = a.height));
          if ("color" in a || "colors" in a)
            (e = a.color || a.colors), Array.isArray(e);
          if (!e) {
            "colorCount" in a && (D = a.colorCount | 0);
            "colorTexture" in a && ((p = !!a.colorTexture), (t = "rgba4"));
            if ("colorType" in a && ((r = a.colorType), !p))
              if ("half float" === r || "float16" === r) t = "rgba16f";
              else if ("float" === r || "float32" === r) t = "rgba32f";
            "colorFormat" in a &&
              ((t = a.colorFormat),
              0 <= B.indexOf(t) ? (p = !0) : 0 <= C.indexOf(t) && (p = !1));
          }
          if ("depthTexture" in a || "depthStencilTexture" in a)
            ha = !(!a.depthTexture && !a.depthStencilTexture);
          "depth" in a &&
            ("boolean" === typeof a.depth
              ? (k = a.depth)
              : ((W = a.depth), (m = !1)));
          "stencil" in a &&
            ("boolean" === typeof a.stencil
              ? (m = a.stencil)
              : ((la = a.stencil), (k = !1)));
          "depthStencil" in a &&
            ("boolean" === typeof a.depthStencil
              ? (k = m = a.depthStencil)
              : ((Z = a.depthStencil), (m = k = !1)));
        } else f = h = 1;
        var G = null,
          A = null,
          Q = null,
          x = null;
        if (Array.isArray(e)) G = e.map(v);
        else if (e) G = [v(e)];
        else for (G = Array(D), e = 0; e < D; ++e) G[e] = l(f, h, p, t, r);
        f = f || G[0].width;
        h = h || G[0].height;
        W ? (A = v(W)) : k && !m && (A = l(f, h, ha, "depth", "uint32"));
        la ? (Q = v(la)) : m && !k && (Q = l(f, h, !1, "stencil", "uint8"));
        Z
          ? (x = v(Z))
          : !W &&
            !la &&
            m &&
            k &&
            (x = l(f, h, ha, "depth stencil", "depth stencil"));
        k = null;
        for (e = 0; e < G.length; ++e)
          g(G[e], f, h),
            G[e] &&
              G[e].texture &&
              ((m =
                ob[G[e].texture._texture.format] *
                Ma[G[e].texture._texture.type]),
              null === k && (k = m));
        g(A, f, h);
        g(Q, f, h);
        g(x, f, h);
        n(d);
        d.width = f;
        d.height = h;
        d.colorAttachments = G;
        d.depthAttachment = A;
        d.stencilAttachment = Q;
        d.depthStencilAttachment = x;
        c.color = G.map(u);
        c.depth = u(A);
        c.stencil = u(Q);
        c.depthStencil = u(x);
        c.width = d.width;
        c.height = d.height;
        w(d);
        return c;
      }
      var d = new e();
      k.framebufferCount++;
      c(a, b);
      return A(c, {
        resize: function (a, b) {
          var e = a | 0,
            g = b | 0 || e;
          if (e === d.width && g === d.height) return c;
          for (var f = d.colorAttachments, h = 0; h < f.length; ++h)
            m(f[h], e, g);
          m(d.depthAttachment, e, g);
          m(d.stencilAttachment, e, g);
          m(d.depthStencilAttachment, e, g);
          d.width = c.width = e;
          d.height = c.height = g;
          w(d);
          return c;
        },
        _reglType: "framebuffer",
        _framebuffer: d,
        destroy: function () {
          D(d);
          n(d);
        },
        use: function (a) {
          Z.setFBO({ framebuffer: c }, a);
        },
      });
    }
    var Z = { cur: null, next: null, dirty: !1, setFBO: null },
      B = ["rgba"],
      C = ["rgba4", "rgb565", "rgb5 a1"];
    b.ext_srgb && C.push("srgba");
    b.ext_color_buffer_half_float && C.push("rgba16f", "rgb16f");
    b.webgl_color_buffer_float && C.push("rgba32f");
    var x = ["uint8"];
    b.oes_texture_half_float && x.push("half float", "float16");
    b.oes_texture_float && x.push("float", "float32");
    var M = 0,
      P = {};
    return A(Z, {
      getFramebuffer: function (a) {
        return "function" === typeof a &&
          "framebuffer" === a._reglType &&
          ((a = a._framebuffer), a instanceof e)
          ? a
          : null;
      },
      create: t,
      createCube: function (a) {
        function b(a) {
          var e,
            g = { color: null },
            f = 0,
            h = null;
          e = "rgba";
          var l = "uint8",
            n = 1;
          if ("number" === typeof a) f = a | 0;
          else if (a) {
            "shape" in a
              ? (f = a.shape[0])
              : ("radius" in a && (f = a.radius | 0),
                "width" in a
                  ? (f = a.width | 0)
                  : "height" in a && (f = a.height | 0));
            if ("color" in a || "colors" in a)
              (h = a.color || a.colors), Array.isArray(h);
            h ||
              ("colorCount" in a && (n = a.colorCount | 0),
              "colorType" in a && (l = a.colorType),
              "colorFormat" in a && (e = a.colorFormat));
            "depth" in a && (g.depth = a.depth);
            "stencil" in a && (g.stencil = a.stencil);
            "depthStencil" in a && (g.depthStencil = a.depthStencil);
          } else f = 1;
          if (h)
            if (Array.isArray(h))
              for (a = [], e = 0; e < h.length; ++e) a[e] = h[e];
            else a = [h];
          else
            for (
              a = Array(n), h = { radius: f, format: e, type: l }, e = 0;
              e < n;
              ++e
            )
              a[e] = d.createCube(h);
          g.color = Array(a.length);
          for (e = 0; e < a.length; ++e)
            (n = a[e]),
              (f = f || n.width),
              (g.color[e] = { target: 34069, data: a[e] });
          for (e = 0; 6 > e; ++e) {
            for (n = 0; n < a.length; ++n) g.color[n].target = 34069 + e;
            0 < e &&
              ((g.depth = c[0].depth),
              (g.stencil = c[0].stencil),
              (g.depthStencil = c[0].depthStencil));
            if (c[e]) c[e](g);
            else c[e] = t(g);
          }
          return A(b, { width: f, height: f, color: a });
        }
        var c = Array(6);
        b(a);
        return A(b, {
          faces: c,
          resize: function (a) {
            var e = a | 0;
            if (e === b.width) return b;
            var g = b.color;
            for (a = 0; a < g.length; ++a) g[a].resize(e);
            for (a = 0; 6 > a; ++a) c[a].resize(e);
            b.width = b.height = e;
            return b;
          },
          _reglType: "framebufferCube",
          destroy: function () {
            c.forEach(function (a) {
              a.destroy();
            });
          },
        });
      },
      clear: function () {
        H(P).forEach(D);
      },
      restore: function () {
        H(P).forEach(function (b) {
          b.framebuffer = a.createFramebuffer();
          w(b);
        });
      },
    });
  }
  function pb() {
    this.w = this.z = this.y = this.x = this.state = 0;
    this.buffer = null;
    this.size = 0;
    this.normalized = !1;
    this.type = 5126;
    this.divisor = this.stride = this.offset = 0;
  }
  function Kb(a, b, c, d, f) {
    a = c.maxAttributes;
    b = Array(a);
    for (c = 0; c < a; ++c) b[c] = new pb();
    return { Record: pb, scope: {}, state: b };
  }
  function Lb(a, b, c, d) {
    function f(a, b, c, g) {
      this.name = a;
      this.id = b;
      this.location = c;
      this.info = g;
    }
    function k(a, b) {
      for (var c = 0; c < a.length; ++c)
        if (a[c].id === b.id) {
          a[c].location = b.location;
          return;
        }
      a.push(b);
    }
    function p(c, g, d) {
      d = 35632 === c ? r : v;
      var f = d[g];
      if (!f) {
        var h = b.str(g),
          f = a.createShader(c);
        a.shaderSource(f, h);
        a.compileShader(f);
        d[g] = f;
      }
      return f;
    }
    function h(a, b) {
      this.id = m++;
      this.fragId = a;
      this.vertId = b;
      this.program = null;
      this.uniforms = [];
      this.attributes = [];
      d.profile && (this.stats = { uniformsCount: 0, attributesCount: 0 });
    }
    function g(c, g) {
      var h, l;
      h = p(35632, c.fragId);
      l = p(35633, c.vertId);
      var m = (c.program = a.createProgram());
      a.attachShader(m, h);
      a.attachShader(m, l);
      a.linkProgram(m);
      var r = a.getProgramParameter(m, 35718);
      d.profile && (c.stats.uniformsCount = r);
      var u = c.uniforms;
      for (h = 0; h < r; ++h)
        if ((l = a.getActiveUniform(m, h)))
          if (1 < l.size)
            for (var v = 0; v < l.size; ++v) {
              var A = l.name.replace("[0]", "[" + v + "]");
              k(u, new f(A, b.id(A), a.getUniformLocation(m, A), l));
            }
          else
            k(
              u,
              new f(l.name, b.id(l.name), a.getUniformLocation(m, l.name), l),
            );
      r = a.getProgramParameter(m, 35721);
      d.profile && (c.stats.attributesCount = r);
      u = c.attributes;
      for (h = 0; h < r; ++h)
        (l = a.getActiveAttrib(m, h)) &&
          k(u, new f(l.name, b.id(l.name), a.getAttribLocation(m, l.name), l));
    }
    var r = {},
      v = {},
      l = {},
      u = [],
      m = 0;
    d.profile &&
      ((c.getMaxUniformsCount = function () {
        var a = 0;
        u.forEach(function (b) {
          b.stats.uniformsCount > a && (a = b.stats.uniformsCount);
        });
        return a;
      }),
      (c.getMaxAttributesCount = function () {
        var a = 0;
        u.forEach(function (b) {
          b.stats.attributesCount > a && (a = b.stats.attributesCount);
        });
        return a;
      }));
    return {
      clear: function () {
        var b = a.deleteShader.bind(a);
        H(r).forEach(b);
        r = {};
        H(v).forEach(b);
        v = {};
        u.forEach(function (b) {
          a.deleteProgram(b.program);
        });
        u.length = 0;
        l = {};
        c.shaderCount = 0;
      },
      program: function (a, b, f) {
        var d = l[b];
        d || (d = l[b] = {});
        var m = d[a];
        m ||
          ((m = new h(b, a)), c.shaderCount++, g(m, f), (d[a] = m), u.push(m));
        return m;
      },
      restore: function () {
        r = {};
        v = {};
        for (var a = 0; a < u.length; ++a) g(u[a]);
      },
      shader: p,
      frag: -1,
      vert: -1,
    };
  }
  function Mb(a, b, c, d, f, k) {
    function p(g) {
      var f;
      f =
        null === b.next
          ? 5121
          : b.next.colorAttachments[0].texture._texture.type;
      var h = 0,
        l = 0,
        k = d.framebufferWidth,
        m = d.framebufferHeight,
        e = null;
      O(g)
        ? (e = g)
        : g &&
          ((h = g.x | 0),
          (l = g.y | 0),
          (k = (g.width || d.framebufferWidth - h) | 0),
          (m = (g.height || d.framebufferHeight - l) | 0),
          (e = g.data || null));
      c();
      g = k * m * 4;
      e ||
        (5121 === f
          ? (e = new Uint8Array(g))
          : 5126 === f && (e = e || new Float32Array(g)));
      a.pixelStorei(3333, 4);
      a.readPixels(h, l, k, m, 6408, f, e);
      return e;
    }
    function h(a) {
      var c;
      b.setFBO({ framebuffer: a.framebuffer }, function () {
        c = p(a);
      });
      return c;
    }
    return function (a) {
      return a && "framebuffer" in a ? h(a) : p(a);
    };
  }
  function Ba(a) {
    return Array.prototype.slice.call(a);
  }
  function Ca(a) {
    return Ba(a).join("");
  }
  function Nb() {
    function a() {
      var a = [],
        b = [];
      return A(
        function () {
          a.push.apply(a, Ba(arguments));
        },
        {
          def: function () {
            var f = "v" + c++;
            b.push(f);
            0 < arguments.length &&
              (a.push(f, "="), a.push.apply(a, Ba(arguments)), a.push(";"));
            return f;
          },
          toString: function () {
            return Ca([0 < b.length ? "var " + b + ";" : "", Ca(a)]);
          },
        },
      );
    }
    function b() {
      function b(a, d) {
        f(a, d, "=", c.def(a, d), ";");
      }
      var c = a(),
        f = a(),
        d = c.toString,
        l = f.toString;
      return A(
        function () {
          c.apply(c, Ba(arguments));
        },
        {
          def: c.def,
          entry: c,
          exit: f,
          save: b,
          set: function (a, f, e) {
            b(a, f);
            c(a, f, "=", e, ";");
          },
          toString: function () {
            return d() + l();
          },
        },
      );
    }
    var c = 0,
      d = [],
      f = [],
      k = a(),
      p = {};
    return {
      global: k,
      link: function (a) {
        for (var b = 0; b < f.length; ++b) if (f[b] === a) return d[b];
        b = "g" + c++;
        d.push(b);
        f.push(a);
        return b;
      },
      block: a,
      proc: function (a, c) {
        function f() {
          var a = "a" + d.length;
          d.push(a);
          return a;
        }
        var d = [];
        c = c || 0;
        for (var l = 0; l < c; ++l) f();
        var l = b(),
          k = l.toString;
        return (p[a] = A(l, {
          arg: f,
          toString: function () {
            return Ca(["function(", d.join(), "){", k(), "}"]);
          },
        }));
      },
      scope: b,
      cond: function () {
        var a = Ca(arguments),
          c = b(),
          f = b(),
          d = c.toString,
          l = f.toString;
        return A(c, {
          then: function () {
            c.apply(c, Ba(arguments));
            return this;
          },
          else: function () {
            f.apply(f, Ba(arguments));
            return this;
          },
          toString: function () {
            var b = l();
            b && (b = "else{" + b + "}");
            return Ca(["if(", a, "){", d(), "}", b]);
          },
        });
      },
      compile: function () {
        var a = ['"use strict";', k, "return {"];
        Object.keys(p).forEach(function (b) {
          a.push('"', b, '":', p[b].toString(), ",");
        });
        a.push("}");
        var b = Ca(a)
          .replace(/;/g, ";\n")
          .replace(/}/g, "}\n")
          .replace(/{/g, "{\n");
        return Function.apply(null, d.concat(b)).apply(null, f);
      },
    };
  }
  function Na(a) {
    return Array.isArray(a) || O(a) || ja(a);
  }
  function qb(a) {
    return a.sort(function (a, c) {
      return "viewport" === a ? -1 : "viewport" === c ? 1 : a < c ? -1 : 1;
    });
  }
  function Y(a, b, c, d) {
    this.thisDep = a;
    this.contextDep = b;
    this.propDep = c;
    this.append = d;
  }
  function ta(a) {
    return a && !(a.thisDep || a.contextDep || a.propDep);
  }
  function B(a) {
    return new Y(!1, !1, !1, a);
  }
  function N(a, b) {
    var c = a.type;
    return 0 === c
      ? ((c = a.data.length), new Y(!0, 1 <= c, 2 <= c, b))
      : 4 === c
        ? ((c = a.data), new Y(c.thisDep, c.contextDep, c.propDep, b))
        : new Y(3 === c, 2 === c, 1 === c, b);
  }
  function Ob(a, b, c, d, f, k, p, h, g, r, v, l, u, m, e) {
    function n(a) {
      return a.replace(".", "_");
    }
    function D(a, b, c) {
      var e = n(a);
      Ja.push(a);
      Fa[e] = pa[e] = !!c;
      qa[e] = b;
    }
    function w(a, b, c) {
      var e = n(a);
      Ja.push(a);
      Array.isArray(c)
        ? ((pa[e] = c.slice()), (Fa[e] = c.slice()))
        : (pa[e] = Fa[e] = c);
      ra[e] = b;
    }
    function t() {
      var a = Nb(),
        c = a.link,
        e = a.global;
      a.id = oa++;
      a.batchId = "0";
      var f = c(ga),
        d = (a.shared = { props: "a0" });
      Object.keys(ga).forEach(function (a) {
        d[a] = e.def(f, ".", a);
      });
      var g = (a.next = {}),
        ca = (a.current = {});
      Object.keys(ra).forEach(function (a) {
        Array.isArray(pa[a]) &&
          ((g[a] = e.def(d.next, ".", a)), (ca[a] = e.def(d.current, ".", a)));
      });
      var F = (a.constants = {});
      Object.keys(da).forEach(function (a) {
        F[a] = e.def(JSON.stringify(da[a]));
      });
      a.invoke = function (b, e) {
        switch (e.type) {
          case 0:
            var X = ["this", d.context, d.props, a.batchId];
            return b.def(
              c(e.data),
              ".call(",
              X.slice(0, Math.max(e.data.length + 1, 4)),
              ")",
            );
          case 1:
            return b.def(d.props, e.data);
          case 2:
            return b.def(d.context, e.data);
          case 3:
            return b.def("this", e.data);
          case 4:
            return e.data.append(a, b), e.data.ref;
        }
      };
      a.attribCache = {};
      var X = {};
      a.scopeAttrib = function (a) {
        a = b.id(a);
        if (a in X) return X[a];
        var e = r.scope[a];
        e || (e = r.scope[a] = new xa());
        return (X[a] = c(e));
      };
      return a;
    }
    function Z(a) {
      var b = a["static"];
      a = a.dynamic;
      var c;
      if ("profile" in b) {
        var e = !!b.profile;
        c = B(function (a, b) {
          return e;
        });
        c.enable = e;
      } else if ("profile" in a) {
        var f = a.profile;
        c = N(f, function (a, b) {
          return a.invoke(b, f);
        });
      }
      return c;
    }
    function A(a, b) {
      var c = a["static"],
        e = a.dynamic;
      if ("framebuffer" in c) {
        var f = c.framebuffer;
        return f
          ? ((f = h.getFramebuffer(f)),
            B(function (a, b) {
              var c = a.link(f),
                e = a.shared;
              b.set(e.framebuffer, ".next", c);
              e = e.context;
              b.set(e, ".framebufferWidth", c + ".width");
              b.set(e, ".framebufferHeight", c + ".height");
              return c;
            }))
          : B(function (a, b) {
              var c = a.shared;
              b.set(c.framebuffer, ".next", "null");
              c = c.context;
              b.set(c, ".framebufferWidth", c + ".drawingBufferWidth");
              b.set(c, ".framebufferHeight", c + ".drawingBufferHeight");
              return "null";
            });
      }
      if ("framebuffer" in e) {
        var d = e.framebuffer;
        return N(d, function (a, b) {
          var c = a.invoke(b, d),
            e = a.shared,
            q = e.framebuffer,
            c = b.def(q, ".getFramebuffer(", c, ")");
          b.set(q, ".next", c);
          e = e.context;
          b.set(
            e,
            ".framebufferWidth",
            c + "?" + c + ".width:" + e + ".drawingBufferWidth",
          );
          b.set(
            e,
            ".framebufferHeight",
            c + "?" + c + ".height:" + e + ".drawingBufferHeight",
          );
          return c;
        });
      }
      return null;
    }
    function x(a, b, c) {
      function e(a) {
        if (a in f) {
          var c = f[a];
          a = !0;
          var q = c.x | 0,
            g = c.y | 0,
            K,
            ca;
          "width" in c ? (K = c.width | 0) : (a = !1);
          "height" in c ? (ca = c.height | 0) : (a = !1);
          return new Y(
            !a && b && b.thisDep,
            !a && b && b.contextDep,
            !a && b && b.propDep,
            function (a, b) {
              var e = a.shared.context,
                f = K;
              "width" in c || (f = b.def(e, ".", "framebufferWidth", "-", q));
              var d = ca;
              "height" in c || (d = b.def(e, ".", "framebufferHeight", "-", g));
              return [q, g, f, d];
            },
          );
        }
        if (a in d) {
          var l = d[a];
          a = N(l, function (a, b) {
            var c = a.invoke(b, l),
              e = a.shared.context,
              q = b.def(c, ".x|0"),
              f = b.def(c, ".y|0"),
              d = b.def(
                '"width" in ',
                c,
                "?",
                c,
                ".width|0:",
                "(",
                e,
                ".",
                "framebufferWidth",
                "-",
                q,
                ")",
              ),
              c = b.def(
                '"height" in ',
                c,
                "?",
                c,
                ".height|0:",
                "(",
                e,
                ".",
                "framebufferHeight",
                "-",
                f,
                ")",
              );
            return [q, f, d, c];
          });
          b &&
            ((a.thisDep = a.thisDep || b.thisDep),
            (a.contextDep = a.contextDep || b.contextDep),
            (a.propDep = a.propDep || b.propDep));
          return a;
        }
        return b
          ? new Y(b.thisDep, b.contextDep, b.propDep, function (a, b) {
              var c = a.shared.context;
              return [
                0,
                0,
                b.def(c, ".", "framebufferWidth"),
                b.def(c, ".", "framebufferHeight"),
              ];
            })
          : null;
      }
      var f = a["static"],
        d = a.dynamic;
      if ((a = e("viewport"))) {
        var g = a;
        a = new Y(a.thisDep, a.contextDep, a.propDep, function (a, b) {
          var c = g.append(a, b),
            e = a.shared.context;
          b.set(e, ".viewportWidth", c[2]);
          b.set(e, ".viewportHeight", c[3]);
          return c;
        });
      }
      return { viewport: a, scissor_box: e("scissor.box") };
    }
    function C(a) {
      function c(a) {
        if (a in e) {
          var d = b.id(e[a]);
          a = B(function () {
            return d;
          });
          a.id = d;
          return a;
        }
        if (a in f) {
          var q = f[a];
          return N(q, function (a, b) {
            var c = a.invoke(b, q);
            return b.def(a.shared.strings, ".id(", c, ")");
          });
        }
        return null;
      }
      var e = a["static"],
        f = a.dynamic,
        d = c("frag"),
        g = c("vert"),
        ca = null;
      ta(d) && ta(g)
        ? ((ca = v.program(g.id, d.id)),
          (a = B(function (a, b) {
            return a.link(ca);
          })))
        : (a = new Y(
            (d && d.thisDep) || (g && g.thisDep),
            (d && d.contextDep) || (g && g.contextDep),
            (d && d.propDep) || (g && g.propDep),
            function (a, b) {
              var c = a.shared.shader,
                e;
              e = d ? d.append(a, b) : b.def(c, ".", "frag");
              var f;
              f = g ? g.append(a, b) : b.def(c, ".", "vert");
              return b.def(c + ".program(" + f + "," + e + ")");
            },
          ));
      return { frag: d, vert: g, progVar: a, program: ca };
    }
    function M(a, b) {
      function c(a, b) {
        if (a in e) {
          var q = e[a] | 0;
          return B(function (a, c) {
            b && (a.OFFSET = q);
            return q;
          });
        }
        if (a in f) {
          var g = f[a];
          return N(g, function (a, c) {
            var e = a.invoke(c, g);
            b && (a.OFFSET = e);
            return e;
          });
        }
        return b && d
          ? B(function (a, b) {
              a.OFFSET = "0";
              return 0;
            })
          : null;
      }
      var e = a["static"],
        f = a.dynamic,
        d = (function () {
          if ("elements" in e) {
            var a = e.elements;
            Na(a)
              ? (a = k.getElements(k.create(a, !0)))
              : a && (a = k.getElements(a));
            var b = B(function (b, c) {
              if (a) {
                var e = b.link(a);
                return (b.ELEMENTS = e);
              }
              return (b.ELEMENTS = null);
            });
            b.value = a;
            return b;
          }
          if ("elements" in f) {
            var c = f.elements;
            return N(c, function (a, b) {
              var e = a.shared,
                d = e.isBufferArgs,
                e = e.elements,
                f = a.invoke(b, c),
                q = b.def("null"),
                d = b.def(d, "(", f, ")"),
                f = a
                  .cond(d)
                  .then(q, "=", e, ".createStream(", f, ");")
                  ["else"](q, "=", e, ".getElements(", f, ");");
              b.entry(f);
              b.exit(a.cond(d).then(e, ".destroyStream(", q, ");"));
              return (a.ELEMENTS = q);
            });
          }
          return null;
        })(),
        g = c("offset", !0);
      return {
        elements: d,
        primitive: (function () {
          if ("primitive" in e) {
            var a = e.primitive;
            return B(function (b, c) {
              return Ra[a];
            });
          }
          if ("primitive" in f) {
            var b = f.primitive;
            return N(b, function (a, c) {
              var e = a.constants.primTypes,
                d = a.invoke(c, b);
              return c.def(e, "[", d, "]");
            });
          }
          return d
            ? ta(d)
              ? d.value
                ? B(function (a, b) {
                    return b.def(a.ELEMENTS, ".primType");
                  })
                : B(function () {
                    return 4;
                  })
              : new Y(d.thisDep, d.contextDep, d.propDep, function (a, b) {
                  var c = a.ELEMENTS;
                  return b.def(c, "?", c, ".primType:", 4);
                })
            : null;
        })(),
        count: (function () {
          if ("count" in e) {
            var a = e.count | 0;
            return B(function () {
              return a;
            });
          }
          if ("count" in f) {
            var b = f.count;
            return N(b, function (a, c) {
              return a.invoke(c, b);
            });
          }
          return d
            ? ta(d)
              ? d
                ? g
                  ? new Y(g.thisDep, g.contextDep, g.propDep, function (a, b) {
                      return b.def(a.ELEMENTS, ".vertCount-", a.OFFSET);
                    })
                  : B(function (a, b) {
                      return b.def(a.ELEMENTS, ".vertCount");
                    })
                : B(function () {
                    return -1;
                  })
              : new Y(
                  d.thisDep || g.thisDep,
                  d.contextDep || g.contextDep,
                  d.propDep || g.propDep,
                  function (a, b) {
                    var c = a.ELEMENTS;
                    return a.OFFSET
                      ? b.def(c, "?", c, ".vertCount-", a.OFFSET, ":-1")
                      : b.def(c, "?", c, ".vertCount:-1");
                  },
                )
            : null;
        })(),
        instances: c("instances", !1),
        offset: g,
      };
    }
    function P(a, b) {
      var c = a["static"],
        e = a.dynamic,
        d = {};
      Ja.forEach(function (a) {
        function b(q, g) {
          if (a in c) {
            var y = q(c[a]);
            d[f] = B(function () {
              return y;
            });
          } else if (a in e) {
            var l = e[a];
            d[f] = N(l, function (a, b) {
              return g(a, b, a.invoke(b, l));
            });
          }
        }
        var f = n(a);
        switch (a) {
          case "cull.enable":
          case "blend.enable":
          case "dither":
          case "stencil.enable":
          case "depth.enable":
          case "scissor.enable":
          case "polygonOffset.enable":
          case "sample.alpha":
          case "sample.enable":
          case "depth.mask":
            return b(
              function (a) {
                return a;
              },
              function (a, b, c) {
                return c;
              },
            );
          case "depth.func":
            return b(
              function (a) {
                return Ua[a];
              },
              function (a, b, c) {
                return b.def(a.constants.compareFuncs, "[", c, "]");
              },
            );
          case "depth.range":
            return b(
              function (a) {
                return a;
              },
              function (a, b, c) {
                a = b.def("+", c, "[0]");
                b = b.def("+", c, "[1]");
                return [a, b];
              },
            );
          case "blend.func":
            return b(
              function (a) {
                return [
                  Ga["srcRGB" in a ? a.srcRGB : a.src],
                  Ga["dstRGB" in a ? a.dstRGB : a.dst],
                  Ga["srcAlpha" in a ? a.srcAlpha : a.src],
                  Ga["dstAlpha" in a ? a.dstAlpha : a.dst],
                ];
              },
              function (a, b, c) {
                function e(a, d) {
                  return b.def(
                    '"',
                    a,
                    d,
                    '" in ',
                    c,
                    "?",
                    c,
                    ".",
                    a,
                    d,
                    ":",
                    c,
                    ".",
                    a,
                  );
                }
                a = a.constants.blendFuncs;
                var d = e("src", "RGB"),
                  f = e("dst", "RGB"),
                  d = b.def(a, "[", d, "]"),
                  q = b.def(a, "[", e("src", "Alpha"), "]"),
                  f = b.def(a, "[", f, "]");
                a = b.def(a, "[", e("dst", "Alpha"), "]");
                return [d, f, q, a];
              },
            );
          case "blend.equation":
            return b(
              function (a) {
                if ("string" === typeof a) return [V[a], V[a]];
                if ("object" === typeof a) return [V[a.rgb], V[a.alpha]];
              },
              function (a, b, c) {
                var e = a.constants.blendEquations,
                  d = b.def(),
                  f = b.def();
                a = a.cond("typeof ", c, '==="string"');
                a.then(d, "=", f, "=", e, "[", c, "];");
                a["else"](
                  d,
                  "=",
                  e,
                  "[",
                  c,
                  ".rgb];",
                  f,
                  "=",
                  e,
                  "[",
                  c,
                  ".alpha];",
                );
                b(a);
                return [d, f];
              },
            );
          case "blend.color":
            return b(
              function (a) {
                return J(4, function (b) {
                  return +a[b];
                });
              },
              function (a, b, c) {
                return J(4, function (a) {
                  return b.def("+", c, "[", a, "]");
                });
              },
            );
          case "stencil.mask":
            return b(
              function (a) {
                return a | 0;
              },
              function (a, b, c) {
                return b.def(c, "|0");
              },
            );
          case "stencil.func":
            return b(
              function (a) {
                return [
                  Ua[a.cmp || "keep"],
                  a.ref || 0,
                  "mask" in a ? a.mask : -1,
                ];
              },
              function (a, b, c) {
                a = b.def(
                  '"cmp" in ',
                  c,
                  "?",
                  a.constants.compareFuncs,
                  "[",
                  c,
                  ".cmp]",
                  ":",
                  7680,
                );
                var e = b.def(c, ".ref|0");
                b = b.def('"mask" in ', c, "?", c, ".mask|0:-1");
                return [a, e, b];
              },
            );
          case "stencil.opFront":
          case "stencil.opBack":
            return b(
              function (b) {
                return [
                  "stencil.opBack" === a ? 1029 : 1028,
                  Oa[b.fail || "keep"],
                  Oa[b.zfail || "keep"],
                  Oa[b.zpass || "keep"],
                ];
              },
              function (b, c, e) {
                function d(a) {
                  return c.def(
                    '"',
                    a,
                    '" in ',
                    e,
                    "?",
                    f,
                    "[",
                    e,
                    ".",
                    a,
                    "]:",
                    7680,
                  );
                }
                var f = b.constants.stencilOps;
                return [
                  "stencil.opBack" === a ? 1029 : 1028,
                  d("fail"),
                  d("zfail"),
                  d("zpass"),
                ];
              },
            );
          case "polygonOffset.offset":
            return b(
              function (a) {
                return [a.factor | 0, a.units | 0];
              },
              function (a, b, c) {
                a = b.def(c, ".factor|0");
                b = b.def(c, ".units|0");
                return [a, b];
              },
            );
          case "cull.face":
            return b(
              function (a) {
                var b = 0;
                "front" === a ? (b = 1028) : "back" === a && (b = 1029);
                return b;
              },
              function (a, b, c) {
                return b.def(c, '==="front"?', 1028, ":", 1029);
              },
            );
          case "lineWidth":
            return b(
              function (a) {
                return a;
              },
              function (a, b, c) {
                return c;
              },
            );
          case "frontFace":
            return b(
              function (a) {
                return rb[a];
              },
              function (a, b, c) {
                return b.def(c + '==="cw"?2304:2305');
              },
            );
          case "colorMask":
            return b(
              function (a) {
                return a.map(function (a) {
                  return !!a;
                });
              },
              function (a, b, c) {
                return J(4, function (a) {
                  return "!!" + c + "[" + a + "]";
                });
              },
            );
          case "sample.coverage":
            return b(
              function (a) {
                return ["value" in a ? a.value : 1, !!a.invert];
              },
              function (a, b, c) {
                a = b.def('"value" in ', c, "?+", c, ".value:1");
                b = b.def("!!", c, ".invert");
                return [a, b];
              },
            );
        }
      });
      return d;
    }
    function G(a, b) {
      var c = a["static"],
        e = a.dynamic,
        d = {};
      Object.keys(c).forEach(function (a) {
        var b = c[a],
          e;
        if ("number" === typeof b || "boolean" === typeof b)
          e = B(function () {
            return b;
          });
        else if ("function" === typeof b) {
          var f = b._reglType;
          if ("texture2d" === f || "textureCube" === f)
            e = B(function (a) {
              return a.link(b);
            });
          else if ("framebuffer" === f || "framebufferCube" === f)
            e = B(function (a) {
              return a.link(b.color[0]);
            });
        } else
          na(b) &&
            (e = B(function (a) {
              return a.global.def(
                "[",
                J(b.length, function (a) {
                  return b[a];
                }),
                "]",
              );
            }));
        e.value = b;
        d[a] = e;
      });
      Object.keys(e).forEach(function (a) {
        var b = e[a];
        d[a] = N(b, function (a, c) {
          return a.invoke(c, b);
        });
      });
      return d;
    }
    function Q(a, c) {
      var e = a["static"],
        d = a.dynamic,
        g = {};
      Object.keys(e).forEach(function (a) {
        var c = e[a],
          d = b.id(a),
          q = new xa();
        if (Na(c))
          (q.state = 1),
            (q.buffer = f.getBuffer(f.create(c, 34962, !1, !0))),
            (q.type = 0);
        else {
          var y = f.getBuffer(c);
          if (y) (q.state = 1), (q.buffer = y), (q.type = 0);
          else if (c.constant) {
            var l = c.constant;
            q.buffer = "null";
            q.state = 2;
            "number" === typeof l
              ? (q.x = l)
              : Da.forEach(function (a, b) {
                  b < l.length && (q[a] = l[b]);
                });
          } else {
            var y = Na(c.buffer)
                ? f.getBuffer(f.create(c.buffer, 34962, !1, !0))
                : f.getBuffer(c.buffer),
              h = c.offset | 0,
              k = c.stride | 0,
              m = c.size | 0,
              n = !!c.normalized,
              aa = 0;
            "type" in c && (aa = Qa[c.type]);
            c = c.divisor | 0;
            q.buffer = y;
            q.state = 1;
            q.size = m;
            q.normalized = n;
            q.type = aa || y.dtype;
            q.offset = h;
            q.stride = k;
            q.divisor = c;
          }
        }
        g[a] = B(function (a, b) {
          var c = a.attribCache;
          if (d in c) return c[d];
          var e = { isStream: !1 };
          Object.keys(q).forEach(function (a) {
            e[a] = q[a];
          });
          q.buffer &&
            ((e.buffer = a.link(q.buffer)),
            (e.type = e.type || e.buffer + ".dtype"));
          return (c[d] = e);
        });
      });
      Object.keys(d).forEach(function (a) {
        var b = d[a];
        g[a] = N(b, function (a, c) {
          function e(a) {
            c(y[a], "=", d, ".", a, "|0;");
          }
          var d = a.invoke(c, b),
            f = a.shared,
            q = f.isBufferArgs,
            g = f.buffer,
            y = { isStream: c.def(!1) },
            l = new xa();
          l.state = 1;
          Object.keys(l).forEach(function (a) {
            y[a] = c.def("" + l[a]);
          });
          var h = y.buffer,
            K = y.type;
          c(
            "if(",
            q,
            "(",
            d,
            ")){",
            y.isStream,
            "=true;",
            h,
            "=",
            g,
            ".createStream(",
            34962,
            ",",
            d,
            ");",
            K,
            "=",
            h,
            ".dtype;",
            "}else{",
            h,
            "=",
            g,
            ".getBuffer(",
            d,
            ");",
            "if(",
            h,
            "){",
            K,
            "=",
            h,
            ".dtype;",
            '}else if("constant" in ',
            d,
            "){",
            y.state,
            "=",
            2,
            ";",
            "if(typeof " + d + '.constant === "number"){',
            y[Da[0]],
            "=",
            d,
            ".constant;",
            Da.slice(1)
              .map(function (a) {
                return y[a];
              })
              .join("="),
            "=0;",
            "}else{",
            Da.map(function (a, b) {
              return (
                y[a] +
                "=" +
                d +
                ".constant.length>=" +
                b +
                "?" +
                d +
                ".constant[" +
                b +
                "]:0;"
              );
            }).join(""),
            "}}else{",
            "if(",
            q,
            "(",
            d,
            ".buffer)){",
            h,
            "=",
            g,
            ".createStream(",
            34962,
            ",",
            d,
            ".buffer);",
            "}else{",
            h,
            "=",
            g,
            ".getBuffer(",
            d,
            ".buffer);",
            "}",
            K,
            '="type" in ',
            d,
            "?",
            f.glTypes,
            "[",
            d,
            ".type]:",
            h,
            ".dtype;",
            y.normalized,
            "=!!",
            d,
            ".normalized;",
          );
          e("size");
          e("offset");
          e("stride");
          e("divisor");
          c("}}");
          c.exit("if(", y.isStream, "){", g, ".destroyStream(", h, ");", "}");
          return y;
        });
      });
      return g;
    }
    function O(a) {
      var b = a["static"],
        c = a.dynamic,
        e = {};
      Object.keys(b).forEach(function (a) {
        var c = b[a];
        e[a] = B(function (a, b) {
          return "number" === typeof c || "boolean" === typeof c
            ? "" + c
            : a.link(c);
        });
      });
      Object.keys(c).forEach(function (a) {
        var b = c[a];
        e[a] = N(b, function (a, c) {
          return a.invoke(c, b);
        });
      });
      return e;
    }
    function z(a, b, c, e, d) {
      var f = A(a, d),
        g = x(a, f, d),
        l = M(a, d),
        h = P(a, d),
        k = C(a, d),
        m = g.viewport;
      m && (h.viewport = m);
      m = n("scissor.box");
      (g = g[m]) && (h[m] = g);
      g = 0 < Object.keys(h).length;
      f = { framebuffer: f, draw: l, shader: k, state: h, dirty: g };
      f.profile = Z(a, d);
      f.uniforms = G(c, d);
      f.attributes = Q(b, d);
      f.context = O(e, d);
      return f;
    }
    function sa(a, b, c) {
      var e = a.shared.context,
        d = a.scope();
      Object.keys(c).forEach(function (f) {
        b.save(e, "." + f);
        d(e, ".", f, "=", c[f].append(a, b), ";");
      });
      b(d);
    }
    function I(a, b, c, e) {
      var d = a.shared,
        f = d.gl,
        g = d.framebuffer,
        l;
      ka && (l = b.def(d.extensions, ".webgl_draw_buffers"));
      var h = a.constants,
        d = h.drawBuffer,
        h = h.backBuffer;
      a = c ? c.append(a, b) : b.def(g, ".next");
      e || b("if(", a, "!==", g, ".cur){");
      b(
        "if(",
        a,
        "){",
        f,
        ".bindFramebuffer(",
        36160,
        ",",
        a,
        ".framebuffer);",
      );
      ka &&
        b(l, ".drawBuffersWEBGL(", d, "[", a, ".colorAttachments.length]);");
      b("}else{", f, ".bindFramebuffer(", 36160, ",null);");
      ka && b(l, ".drawBuffersWEBGL(", h, ");");
      b("}", g, ".cur=", a, ";");
      e || b("}");
    }
    function T(a, b, c) {
      var e = a.shared,
        d = e.gl,
        f = a.current,
        g = a.next,
        l = e.current,
        h = e.next,
        k = a.cond(l, ".dirty");
      Ja.forEach(function (b) {
        b = n(b);
        if (!(b in c.state)) {
          var e, y;
          if (b in g) {
            e = g[b];
            y = f[b];
            var m = J(pa[b].length, function (a) {
              return k.def(e, "[", a, "]");
            });
            k(
              a
                .cond(
                  m
                    .map(function (a, b) {
                      return a + "!==" + y + "[" + b + "]";
                    })
                    .join("||"),
                )
                .then(
                  d,
                  ".",
                  ra[b],
                  "(",
                  m,
                  ");",
                  m
                    .map(function (a, b) {
                      return y + "[" + b + "]=" + a;
                    })
                    .join(";"),
                  ";",
                ),
            );
          } else
            (e = k.def(h, ".", b)),
              (m = a.cond(e, "!==", l, ".", b)),
              k(m),
              b in qa
                ? m(
                    a
                      .cond(e)
                      .then(d, ".enable(", qa[b], ");")
                      ["else"](d, ".disable(", qa[b], ");"),
                    l,
                    ".",
                    b,
                    "=",
                    e,
                    ";",
                  )
                : m(d, ".", ra[b], "(", e, ");", l, ".", b, "=", e, ";");
        }
      });
      0 === Object.keys(c.state).length && k(l, ".dirty=false;");
      b(k);
    }
    function L(a, b, c, e) {
      var d = a.shared,
        f = a.current,
        g = d.current,
        l = d.gl;
      qb(Object.keys(c)).forEach(function (d) {
        var h = c[d];
        if (!e || e(h)) {
          var k = h.append(a, b);
          if (qa[d]) {
            var m = qa[d];
            ta(h)
              ? k
                ? b(l, ".enable(", m, ");")
                : b(l, ".disable(", m, ");")
              : b(
                  a
                    .cond(k)
                    .then(l, ".enable(", m, ");")
                    ["else"](l, ".disable(", m, ");"),
                );
            b(g, ".", d, "=", k, ";");
          } else if (na(k)) {
            var n = f[d];
            b(
              l,
              ".",
              ra[d],
              "(",
              k,
              ");",
              k
                .map(function (a, b) {
                  return n + "[" + b + "]=" + a;
                })
                .join(";"),
              ";",
            );
          } else b(l, ".", ra[d], "(", k, ");", g, ".", d, "=", k, ";");
        }
      });
    }
    function ua(a, b) {
      ma &&
        (a.instancing = b.def(a.shared.extensions, ".angle_instanced_arrays"));
    }
    function E(a, b, c, e, d) {
      function f() {
        return "undefined" === typeof performance
          ? "Date.now()"
          : "performance.now()";
      }
      function g(a) {
        r = b.def();
        a(r, "=", f(), ";");
        "string" === typeof d ? a(n, ".count+=", d, ";") : a(n, ".count++;");
        m &&
          (e
            ? ((u = b.def()), a(u, "=", t, ".getNumPendingQueries();"))
            : a(t, ".beginQuery(", n, ");"));
      }
      function l(a) {
        a(n, ".cpuTime+=", f(), "-", r, ";");
        m &&
          (e
            ? a(
                t,
                ".pushScopeStats(",
                u,
                ",",
                t,
                ".getNumPendingQueries(),",
                n,
                ");",
              )
            : a(t, ".endQuery();"));
      }
      function h(a) {
        var c = b.def(p, ".profile");
        b(p, ".profile=", a, ";");
        b.exit(p, ".profile=", c, ";");
      }
      var k = a.shared,
        n = a.stats,
        p = k.current,
        t = k.timer;
      c = c.profile;
      var r, u;
      if (c) {
        if (ta(c)) {
          c.enable ? (g(b), l(b.exit), h("true")) : h("false");
          return;
        }
        c = c.append(a, b);
        h(c);
      } else c = b.def(p, ".profile");
      k = a.block();
      g(k);
      b("if(", c, "){", k, "}");
      a = a.block();
      l(a);
      b.exit("if(", c, "){", a, "}");
    }
    function S(a, b, c, e, d) {
      function f(a) {
        switch (a) {
          case 35664:
          case 35667:
          case 35671:
            return 2;
          case 35665:
          case 35668:
          case 35672:
            return 3;
          case 35666:
          case 35669:
          case 35673:
            return 4;
          default:
            return 1;
        }
      }
      function g(c, e, d) {
        function f() {
          b("if(!", n, ".buffer){", k, ".enableVertexAttribArray(", m, ");}");
          var c = d.type,
            g;
          g = d.size ? b.def(d.size, "||", e) : e;
          b(
            "if(",
            n,
            ".type!==",
            c,
            "||",
            n,
            ".size!==",
            g,
            "||",
            aa
              .map(function (a) {
                return n + "." + a + "!==" + d[a];
              })
              .join("||"),
            "){",
            k,
            ".bindBuffer(",
            34962,
            ",",
            K,
            ".buffer);",
            k,
            ".vertexAttribPointer(",
            [m, g, c, d.normalized, d.stride, d.offset],
            ");",
            n,
            ".type=",
            c,
            ";",
            n,
            ".size=",
            g,
            ";",
            aa
              .map(function (a) {
                return n + "." + a + "=" + d[a] + ";";
              })
              .join(""),
            "}",
          );
          ma &&
            ((c = d.divisor),
            b(
              "if(",
              n,
              ".divisor!==",
              c,
              "){",
              a.instancing,
              ".vertexAttribDivisorANGLE(",
              [m, c],
              ");",
              n,
              ".divisor=",
              c,
              ";}",
            ));
        }
        function h() {
          b(
            "if(",
            n,
            ".buffer){",
            k,
            ".disableVertexAttribArray(",
            m,
            ");",
            "}if(",
            Da.map(function (a, b) {
              return n + "." + a + "!==" + p[b];
            }).join("||"),
            "){",
            k,
            ".vertexAttrib4f(",
            m,
            ",",
            p,
            ");",
            Da.map(function (a, b) {
              return n + "." + a + "=" + p[b] + ";";
            }).join(""),
            "}",
          );
        }
        var k = l.gl,
          m = b.def(c, ".location"),
          n = b.def(l.attributes, "[", m, "]");
        c = d.state;
        var K = d.buffer,
          p = [d.x, d.y, d.z, d.w],
          aa = ["buffer", "normalized", "offset", "stride"];
        1 === c
          ? f()
          : 2 === c
            ? h()
            : (b("if(", c, "===", 1, "){"), f(), b("}else{"), h(), b("}"));
      }
      var l = a.shared;
      e.forEach(function (e) {
        var l = e.name,
          h = c.attributes[l],
          k;
        if (h) {
          if (!d(h)) return;
          k = h.append(a, b);
        } else {
          if (!d(sb)) return;
          var m = a.scopeAttrib(l);
          k = {};
          Object.keys(new xa()).forEach(function (a) {
            k[a] = b.def(m, ".", a);
          });
        }
        g(a.link(e), f(e.info.type), k);
      });
    }
    function U(a, c, e, d, f) {
      for (var g = a.shared, l = g.gl, h, k = 0; k < d.length; ++k) {
        var m = d[k],
          n = m.name,
          p = m.info.type,
          t = e.uniforms[n],
          m = a.link(m) + ".location",
          r;
        if (t) {
          if (!f(t)) continue;
          if (ta(t)) {
            n = t.value;
            if (35678 === p || 35680 === p)
              (p = a.link(n._texture || n.color[0]._texture)),
                c(l, ".uniform1i(", m, ",", p + ".bind());"),
                c.exit(p, ".unbind();");
            else if (35674 === p || 35675 === p || 35676 === p)
              (n = a.global.def(
                "new Float32Array([" + Array.prototype.slice.call(n) + "])",
              )),
                (t = 2),
                35675 === p ? (t = 3) : 35676 === p && (t = 4),
                c(l, ".uniformMatrix", t, "fv(", m, ",false,", n, ");");
            else {
              switch (p) {
                case 5126:
                  h = "1f";
                  break;
                case 35664:
                  h = "2f";
                  break;
                case 35665:
                  h = "3f";
                  break;
                case 35666:
                  h = "4f";
                  break;
                case 35670:
                  h = "1i";
                  break;
                case 5124:
                  h = "1i";
                  break;
                case 35671:
                  h = "2i";
                  break;
                case 35667:
                  h = "2i";
                  break;
                case 35672:
                  h = "3i";
                  break;
                case 35668:
                  h = "3i";
                  break;
                case 35673:
                  h = "4i";
                  break;
                case 35669:
                  h = "4i";
              }
              c(
                l,
                ".uniform",
                h,
                "(",
                m,
                ",",
                na(n) ? Array.prototype.slice.call(n) : n,
                ");",
              );
            }
            continue;
          } else r = t.append(a, c);
        } else {
          if (!f(sb)) continue;
          r = c.def(g.uniforms, "[", b.id(n), "]");
        }
        35678 === p
          ? c(
              "if(",
              r,
              "&&",
              r,
              '._reglType==="framebuffer"){',
              r,
              "=",
              r,
              ".color[0];",
              "}",
            )
          : 35680 === p &&
            c(
              "if(",
              r,
              "&&",
              r,
              '._reglType==="framebufferCube"){',
              r,
              "=",
              r,
              ".color[0];",
              "}",
            );
        n = 1;
        switch (p) {
          case 35678:
          case 35680:
            p = c.def(r, "._texture");
            c(l, ".uniform1i(", m, ",", p, ".bind());");
            c.exit(p, ".unbind();");
            continue;
          case 5124:
          case 35670:
            h = "1i";
            break;
          case 35667:
          case 35671:
            h = "2i";
            n = 2;
            break;
          case 35668:
          case 35672:
            h = "3i";
            n = 3;
            break;
          case 35669:
          case 35673:
            h = "4i";
            n = 4;
            break;
          case 5126:
            h = "1f";
            break;
          case 35664:
            h = "2f";
            n = 2;
            break;
          case 35665:
            h = "3f";
            n = 3;
            break;
          case 35666:
            h = "4f";
            n = 4;
            break;
          case 35674:
            h = "Matrix2fv";
            break;
          case 35675:
            h = "Matrix3fv";
            break;
          case 35676:
            h = "Matrix4fv";
        }
        c(l, ".uniform", h, "(", m, ",");
        if ("M" === h.charAt(0)) {
          var m = Math.pow(p - 35674 + 2, 2),
            u = a.global.def("new Float32Array(", m, ")");
          c(
            "false,(Array.isArray(",
            r,
            ")||",
            r,
            " instanceof Float32Array)?",
            r,
            ":(",
            J(m, function (a) {
              return u + "[" + a + "]=" + r + "[" + a + "]";
            }),
            ",",
            u,
            ")",
          );
        } else
          1 < n
            ? c(
                J(n, function (a) {
                  return r + "[" + a + "]";
                }),
              )
            : c(r);
        c(");");
      }
    }
    function H(a, b, c, e) {
      function d(f) {
        var g = m[f];
        return g
          ? (g.contextDep && e.contextDynamic) || g.propDep
            ? g.append(a, c)
            : g.append(a, b)
          : b.def(k, ".", f);
      }
      function f() {
        function a() {
          c(
            w,
            ".drawElementsInstancedANGLE(",
            [p, t, W, r + "<<((" + W + "-5121)>>1)", u],
            ");",
          );
        }
        function b() {
          c(w, ".drawArraysInstancedANGLE(", [p, r, t, u], ");");
        }
        n
          ? v
            ? a()
            : (c("if(", n, "){"), a(), c("}else{"), b(), c("}"))
          : b();
      }
      function g() {
        function a() {
          c(
            l +
              ".drawElements(" +
              [p, t, W, r + "<<((" + W + "-5121)>>1)"] +
              ");",
          );
        }
        function b() {
          c(l + ".drawArrays(" + [p, r, t] + ");");
        }
        n
          ? v
            ? a()
            : (c("if(", n, "){"), a(), c("}else{"), b(), c("}"))
          : b();
      }
      var h = a.shared,
        l = h.gl,
        k = h.draw,
        m = e.draw,
        n = (function () {
          var d = m.elements,
            f = b;
          if (d) {
            if ((d.contextDep && e.contextDynamic) || d.propDep) f = c;
            d = d.append(a, f);
          } else d = f.def(k, ".", "elements");
          d &&
            f(
              "if(" +
                d +
                ")" +
                l +
                ".bindBuffer(34963," +
                d +
                ".buffer.buffer);",
            );
          return d;
        })(),
        p = d("primitive"),
        r = d("offset"),
        t = (function () {
          var d = m.count,
            f = b;
          if (d) {
            if ((d.contextDep && e.contextDynamic) || d.propDep) f = c;
            d = d.append(a, f);
          } else d = f.def(k, ".", "count");
          return d;
        })();
      if ("number" === typeof t) {
        if (0 === t) return;
      } else c("if(", t, "){"), c.exit("}");
      var u, w;
      ma && ((u = d("instances")), (w = a.instancing));
      var W = n + ".type",
        v = m.elements && ta(m.elements);
      ma && ("number" !== typeof u || 0 <= u)
        ? "string" === typeof u
          ? (c("if(", u, ">0){"), f(), c("}else if(", u, "<0){"), g(), c("}"))
          : f()
        : g();
    }
    function ba(a, b, c, e, d) {
      b = t();
      d = b.proc("body", d);
      ma &&
        (b.instancing = d.def(b.shared.extensions, ".angle_instanced_arrays"));
      a(b, d, c, e);
      return b.compile().body;
    }
    function R(a, b, c, e) {
      ua(a, b);
      S(a, b, c, e.attributes, function () {
        return !0;
      });
      U(a, b, c, e.uniforms, function () {
        return !0;
      });
      H(a, b, b, c);
    }
    function W(a, b) {
      var c = a.proc("draw", 1);
      ua(a, c);
      sa(a, c, b.context);
      I(a, c, b.framebuffer);
      T(a, c, b);
      L(a, c, b.state);
      E(a, c, b, !1, !0);
      var e = b.shader.progVar.append(a, c);
      c(a.shared.gl, ".useProgram(", e, ".program);");
      if (b.shader.program) R(a, c, b, b.shader.program);
      else {
        var d = a.global.def("{}"),
          f = c.def(e, ".id"),
          g = c.def(d, "[", f, "]");
        c(
          a
            .cond(g)
            .then(g, ".call(this,a0);")
            ["else"](
              g,
              "=",
              d,
              "[",
              f,
              "]=",
              a.link(function (c) {
                return ba(R, a, b, c, 1);
              }),
              "(",
              e,
              ");",
              g,
              ".call(this,a0);",
            ),
        );
      }
      0 < Object.keys(b.state).length && c(a.shared.current, ".dirty=true;");
    }
    function la(a, b, c, e) {
      function d() {
        return !0;
      }
      a.batchId = "a1";
      ua(a, b);
      S(a, b, c, e.attributes, d);
      U(a, b, c, e.uniforms, d);
      H(a, b, b, c);
    }
    function ya(a, b, c, e) {
      function d(a) {
        return (a.contextDep && g) || a.propDep;
      }
      function f(a) {
        return !d(a);
      }
      ua(a, b);
      var g = c.contextDep,
        h = b.def(),
        l = b.def();
      a.shared.props = l;
      a.batchId = h;
      var k = a.scope(),
        m = a.scope();
      b(
        k.entry,
        "for(",
        h,
        "=0;",
        h,
        "<",
        "a1",
        ";++",
        h,
        "){",
        l,
        "=",
        "a0",
        "[",
        h,
        "];",
        m,
        "}",
        k.exit,
      );
      c.needsContext && sa(a, m, c.context);
      c.needsFramebuffer && I(a, m, c.framebuffer);
      L(a, m, c.state, d);
      c.profile && d(c.profile) && E(a, m, c, !1, !0);
      e
        ? (S(a, k, c, e.attributes, f),
          S(a, m, c, e.attributes, d),
          U(a, k, c, e.uniforms, f),
          U(a, m, c, e.uniforms, d),
          H(a, k, m, c))
        : ((b = a.global.def("{}")),
          (e = c.shader.progVar.append(a, m)),
          (l = m.def(e, ".id")),
          (k = m.def(b, "[", l, "]")),
          m(
            a.shared.gl,
            ".useProgram(",
            e,
            ".program);",
            "if(!",
            k,
            "){",
            k,
            "=",
            b,
            "[",
            l,
            "]=",
            a.link(function (b) {
              return ba(la, a, c, b, 2);
            }),
            "(",
            e,
            ");}",
            k,
            ".call(this,a0[",
            h,
            "],",
            h,
            ");",
          ));
    }
    function ha(a, b) {
      function c(a) {
        return (a.contextDep && d) || a.propDep;
      }
      var e = a.proc("batch", 2);
      a.batchId = "0";
      ua(a, e);
      var d = !1,
        f = !0;
      Object.keys(b.context).forEach(function (a) {
        d = d || b.context[a].propDep;
      });
      d || (sa(a, e, b.context), (f = !1));
      var g = b.framebuffer,
        h = !1;
      g
        ? (g.propDep ? (d = h = !0) : g.contextDep && d && (h = !0),
          h || I(a, e, g))
        : I(a, e, null);
      b.state.viewport && b.state.viewport.propDep && (d = !0);
      T(a, e, b);
      L(a, e, b.state, function (a) {
        return !c(a);
      });
      (b.profile && c(b.profile)) || E(a, e, b, !1, "a1");
      b.contextDep = d;
      b.needsContext = f;
      b.needsFramebuffer = h;
      f = b.shader.progVar;
      if ((f.contextDep && d) || f.propDep) ya(a, e, b, null);
      else if (
        ((f = f.append(a, e)),
        e(a.shared.gl, ".useProgram(", f, ".program);"),
        b.shader.program)
      )
        ya(a, e, b, b.shader.program);
      else {
        var g = a.global.def("{}"),
          h = e.def(f, ".id"),
          l = e.def(g, "[", h, "]");
        e(
          a
            .cond(l)
            .then(l, ".call(this,a0,a1);")
            ["else"](
              l,
              "=",
              g,
              "[",
              h,
              "]=",
              a.link(function (c) {
                return ba(ya, a, b, c, 2);
              }),
              "(",
              f,
              ");",
              l,
              ".call(this,a0,a1);",
            ),
        );
      }
      0 < Object.keys(b.state).length && e(a.shared.current, ".dirty=true;");
    }
    function ea(a, c) {
      function e(b) {
        var g = c.shader[b];
        g && d.set(f.shader, "." + b, g.append(a, d));
      }
      var d = a.proc("scope", 3);
      a.batchId = "a2";
      var f = a.shared,
        g = f.current;
      sa(a, d, c.context);
      c.framebuffer && c.framebuffer.append(a, d);
      qb(Object.keys(c.state)).forEach(function (b) {
        var e = c.state[b].append(a, d);
        na(e)
          ? e.forEach(function (c, e) {
              d.set(a.next[b], "[" + e + "]", c);
            })
          : d.set(f.next, "." + b, e);
      });
      E(a, d, c, !0, !0);
      ["elements", "offset", "count", "instances", "primitive"].forEach(
        function (b) {
          var e = c.draw[b];
          e && d.set(f.draw, "." + b, "" + e.append(a, d));
        },
      );
      Object.keys(c.uniforms).forEach(function (e) {
        d.set(f.uniforms, "[" + b.id(e) + "]", c.uniforms[e].append(a, d));
      });
      Object.keys(c.attributes).forEach(function (b) {
        var e = c.attributes[b].append(a, d),
          f = a.scopeAttrib(b);
        Object.keys(new xa()).forEach(function (a) {
          d.set(f, "." + a, e[a]);
        });
      });
      e("vert");
      e("frag");
      0 < Object.keys(c.state).length &&
        (d(g, ".dirty=true;"), d.exit(g, ".dirty=true;"));
      d("a1(", a.shared.context, ",a0,", a.batchId, ");");
    }
    function ja(a) {
      if ("object" === typeof a && !na(a)) {
        for (var b = Object.keys(a), c = 0; c < b.length; ++c)
          if (ia.isDynamic(a[b[c]])) return !0;
        return !1;
      }
    }
    function fa(a, b, c) {
      function e(a, b) {
        g.forEach(function (c) {
          var e = d[c];
          ia.isDynamic(e) && ((e = a.invoke(b, e)), b(k, ".", c, "=", e, ";"));
        });
      }
      var d = b["static"][c];
      if (d && ja(d)) {
        var f = a.global,
          g = Object.keys(d),
          h = !1,
          l = !1,
          m = !1,
          k = a.global.def("{}");
        g.forEach(function (b) {
          var c = d[b];
          if (ia.isDynamic(c))
            "function" === typeof c && (c = d[b] = ia.unbox(c)),
              (b = N(c, null)),
              (h = h || b.thisDep),
              (m = m || b.propDep),
              (l = l || b.contextDep);
          else {
            f(k, ".", b, "=");
            switch (typeof c) {
              case "number":
                f(c);
                break;
              case "string":
                f('"', c, '"');
                break;
              case "object":
                Array.isArray(c) && f("[", c.join(), "]");
                break;
              default:
                f(a.link(c));
            }
            f(";");
          }
        });
        b.dynamic[c] = new ia.DynamicVariable(4, {
          thisDep: h,
          contextDep: l,
          propDep: m,
          ref: k,
          append: e,
        });
        delete b["static"][c];
      }
    }
    var xa = r.Record,
      V = { add: 32774, subtract: 32778, "reverse subtract": 32779 };
    c.ext_blend_minmax && ((V.min = 32775), (V.max = 32776));
    var ma = c.angle_instanced_arrays,
      ka = c.webgl_draw_buffers,
      pa = { dirty: !0, profile: e.profile },
      Fa = {},
      Ja = [],
      qa = {},
      ra = {};
    D("dither", 3024);
    D("blend.enable", 3042);
    w("blend.color", "blendColor", [0, 0, 0, 0]);
    w("blend.equation", "blendEquationSeparate", [32774, 32774]);
    w("blend.func", "blendFuncSeparate", [1, 0, 1, 0]);
    D("depth.enable", 2929, !0);
    w("depth.func", "depthFunc", 513);
    w("depth.range", "depthRange", [0, 1]);
    w("depth.mask", "depthMask", !0);
    w("colorMask", "colorMask", [!0, !0, !0, !0]);
    D("cull.enable", 2884);
    w("cull.face", "cullFace", 1029);
    w("frontFace", "frontFace", 2305);
    w("lineWidth", "lineWidth", 1);
    D("polygonOffset.enable", 32823);
    w("polygonOffset.offset", "polygonOffset", [0, 0]);
    D("sample.alpha", 32926);
    D("sample.enable", 32928);
    w("sample.coverage", "sampleCoverage", [1, !1]);
    D("stencil.enable", 2960);
    w("stencil.mask", "stencilMask", -1);
    w("stencil.func", "stencilFunc", [519, 0, -1]);
    w("stencil.opFront", "stencilOpSeparate", [1028, 7680, 7680, 7680]);
    w("stencil.opBack", "stencilOpSeparate", [1029, 7680, 7680, 7680]);
    D("scissor.enable", 3089);
    w("scissor.box", "scissor", [
      0,
      0,
      a.drawingBufferWidth,
      a.drawingBufferHeight,
    ]);
    w("viewport", "viewport", [
      0,
      0,
      a.drawingBufferWidth,
      a.drawingBufferHeight,
    ]);
    var ga = {
        gl: a,
        context: u,
        strings: b,
        next: Fa,
        current: pa,
        draw: l,
        elements: k,
        buffer: f,
        shader: v,
        attributes: r.state,
        uniforms: g,
        framebuffer: h,
        extensions: c,
        timer: m,
        isBufferArgs: Na,
      },
      da = {
        primTypes: Ra,
        compareFuncs: Ua,
        blendFuncs: Ga,
        blendEquations: V,
        stencilOps: Oa,
        glTypes: Qa,
        orientationType: rb,
      };
    ka &&
      ((da.backBuffer = [1029]),
      (da.drawBuffer = J(d.maxDrawbuffers, function (a) {
        return 0 === a
          ? [0]
          : J(a, function (a) {
              return 36064 + a;
            });
      })));
    var oa = 0;
    return {
      next: Fa,
      current: pa,
      procs: (function () {
        var b = t(),
          c = b.proc("poll"),
          e = b.proc("refresh"),
          f = b.block();
        c(f);
        e(f);
        var g = b.shared,
          h = g.gl,
          l = g.next,
          m = g.current;
        f(m, ".dirty=false;");
        I(b, c);
        I(b, e, null, !0);
        var k = a.getExtension("angle_instanced_arrays"),
          n;
        k && (n = b.link(k));
        for (var p = 0; p < d.maxAttributes; ++p) {
          var r = e.def(g.attributes, "[", p, "]"),
            u = b.cond(r, ".buffer");
          u.then(
            h,
            ".enableVertexAttribArray(",
            p,
            ");",
            h,
            ".bindBuffer(",
            34962,
            ",",
            r,
            ".buffer.buffer);",
            h,
            ".vertexAttribPointer(",
            p,
            ",",
            r,
            ".size,",
            r,
            ".type,",
            r,
            ".normalized,",
            r,
            ".stride,",
            r,
            ".offset);",
          )["else"](
            h,
            ".disableVertexAttribArray(",
            p,
            ");",
            h,
            ".vertexAttrib4f(",
            p,
            ",",
            r,
            ".x,",
            r,
            ".y,",
            r,
            ".z,",
            r,
            ".w);",
            r,
            ".buffer=null;",
          );
          e(u);
          k && e(n, ".vertexAttribDivisorANGLE(", p, ",", r, ".divisor);");
        }
        Object.keys(qa).forEach(function (a) {
          var d = qa[a],
            g = f.def(l, ".", a),
            k = b.block();
          k(
            "if(",
            g,
            "){",
            h,
            ".enable(",
            d,
            ")}else{",
            h,
            ".disable(",
            d,
            ")}",
            m,
            ".",
            a,
            "=",
            g,
            ";",
          );
          e(k);
          c("if(", g, "!==", m, ".", a, "){", k, "}");
        });
        Object.keys(ra).forEach(function (a) {
          var d = ra[a],
            g = pa[a],
            k,
            n,
            p = b.block();
          p(h, ".", d, "(");
          na(g)
            ? ((d = g.length),
              (k = b.global.def(l, ".", a)),
              (n = b.global.def(m, ".", a)),
              p(
                J(d, function (a) {
                  return k + "[" + a + "]";
                }),
                ");",
                J(d, function (a) {
                  return n + "[" + a + "]=" + k + "[" + a + "];";
                }).join(""),
              ),
              c(
                "if(",
                J(d, function (a) {
                  return k + "[" + a + "]!==" + n + "[" + a + "]";
                }).join("||"),
                "){",
                p,
                "}",
              ))
            : ((k = f.def(l, ".", a)),
              (n = f.def(m, ".", a)),
              p(k, ");", m, ".", a, "=", k, ";"),
              c("if(", k, "!==", n, "){", p, "}"));
          e(p);
        });
        return b.compile();
      })(),
      compile: function (a, b, c, e, d) {
        var f = t();
        f.stats = f.link(d);
        Object.keys(b["static"]).forEach(function (a) {
          fa(f, b, a);
        });
        Pb.forEach(function (b) {
          fa(f, a, b);
        });
        c = z(a, b, c, e, f);
        W(f, c);
        ea(f, c);
        ha(f, c);
        return f.compile();
      },
    };
  }
  function tb(a, b) {
    for (var c = 0; c < a.length; ++c) if (a[c] === b) return c;
    return -1;
  }
  var A = function (a, b) {
      for (var c = Object.keys(b), d = 0; d < c.length; ++d) a[c[d]] = b[c[d]];
      return a;
    },
    vb = 0,
    ia = {
      DynamicVariable: da,
      define: function (a, b) {
        return new da(a, Wa(b + ""));
      },
      isDynamic: function (a) {
        return ("function" === typeof a && !a._reglType) || a instanceof da;
      },
      unbox: function (a, b) {
        return "function" === typeof a ? new da(0, a) : a;
      },
      accessor: Wa,
    },
    Va = {
      next:
        "function" === typeof requestAnimationFrame
          ? function (a) {
              return requestAnimationFrame(a);
            }
          : function (a) {
              return setTimeout(a, 16);
            },
      cancel:
        "function" === typeof cancelAnimationFrame
          ? function (a) {
              return cancelAnimationFrame(a);
            }
          : clearTimeout,
    },
    ub =
      "undefined" !== typeof performance && performance.now
        ? function () {
            return performance.now();
          }
        : function () {
            return +new Date();
          },
    Qb = function (a, b) {
      var c = 1;
      b.ext_texture_filter_anisotropic && (c = a.getParameter(34047));
      var d = 1,
        f = 1;
      b.webgl_draw_buffers &&
        ((d = a.getParameter(34852)), (f = a.getParameter(36063)));
      return {
        colorBits: [
          a.getParameter(3410),
          a.getParameter(3411),
          a.getParameter(3412),
          a.getParameter(3413),
        ],
        depthBits: a.getParameter(3414),
        stencilBits: a.getParameter(3415),
        subpixelBits: a.getParameter(3408),
        extensions: Object.keys(b).filter(function (a) {
          return !!b[a];
        }),
        maxAnisotropic: c,
        maxDrawbuffers: d,
        maxColorAttachments: f,
        pointSizeDims: a.getParameter(33901),
        lineWidthDims: a.getParameter(33902),
        maxViewportDims: a.getParameter(3386),
        maxCombinedTextureUnits: a.getParameter(35661),
        maxCubeMapSize: a.getParameter(34076),
        maxRenderbufferSize: a.getParameter(34024),
        maxTextureUnits: a.getParameter(34930),
        maxTextureSize: a.getParameter(3379),
        maxAttributes: a.getParameter(34921),
        maxVertexUniforms: a.getParameter(36347),
        maxVertexTextureUnits: a.getParameter(35660),
        maxVaryingVectors: a.getParameter(36348),
        maxFragmentUniforms: a.getParameter(36349),
        glsl: a.getParameter(35724),
        renderer: a.getParameter(7937),
        vendor: a.getParameter(7936),
        version: a.getParameter(7938),
      };
    },
    Ea = {
      "[object Int8Array]": 5120,
      "[object Int16Array]": 5122,
      "[object Int32Array]": 5124,
      "[object Uint8Array]": 5121,
      "[object Uint8ClampedArray]": 5121,
      "[object Uint16Array]": 5123,
      "[object Uint32Array]": 5125,
      "[object Float32Array]": 5126,
      "[object Float64Array]": 5121,
      "[object ArrayBuffer]": 5121,
    },
    O = function (a) {
      return Object.prototype.toString.call(a) in Ea;
    },
    H = function (a) {
      return Object.keys(a).map(function (b) {
        return a[b];
      });
    },
    $a = J(8, function () {
      return [];
    }),
    x = {
      alloc: fa,
      free: ab,
      allocType: function (a, b) {
        var c = null;
        switch (a) {
          case 5120:
            c = new Int8Array(fa(b), 0, b);
            break;
          case 5121:
            c = new Uint8Array(fa(b), 0, b);
            break;
          case 5122:
            c = new Int16Array(fa(2 * b), 0, b);
            break;
          case 5123:
            c = new Uint16Array(fa(2 * b), 0, b);
            break;
          case 5124:
            c = new Int32Array(fa(4 * b), 0, b);
            break;
          case 5125:
            c = new Uint32Array(fa(4 * b), 0, b);
            break;
          case 5126:
            c = new Float32Array(fa(4 * b), 0, b);
            break;
          default:
            return null;
        }
        return c.length !== b ? c.subarray(0, b) : c;
      },
      freeType: function (a) {
        ab(a.buffer);
      },
    },
    La = {
      shape: function (a) {
        for (var b = []; a.length; a = a[0]) b.push(a.length);
        return b;
      },
      flatten: function (a, b, c, d) {
        var f = 1;
        if (b.length) for (var k = 0; k < b.length; ++k) f *= b[k];
        else f = 0;
        c = d || x.allocType(c, f);
        switch (b.length) {
          case 0:
            break;
          case 1:
            d = b[0];
            for (b = 0; b < d; ++b) c[b] = a[b];
            break;
          case 2:
            d = b[0];
            b = b[1];
            for (k = f = 0; k < d; ++k)
              for (var p = a[k], h = 0; h < b; ++h) c[f++] = p[h];
            break;
          case 3:
            bb(a, b[0], b[1], b[2], c, 0);
            break;
          default:
            cb(a, b, 0, c, 0);
        }
        return c;
      },
    },
    Qa = {
      int8: 5120,
      int16: 5122,
      int32: 5124,
      uint8: 5121,
      uint16: 5123,
      uint32: 5125,
      float: 5126,
      float32: 5126,
    },
    hb = { dynamic: 35048, stream: 35040, static: 35044 },
    Pa = La.flatten,
    fb = La.shape,
    ga = [];
  ga[5120] = 1;
  ga[5122] = 2;
  ga[5124] = 4;
  ga[5121] = 1;
  ga[5123] = 2;
  ga[5125] = 4;
  ga[5126] = 4;
  var Ra = {
      points: 0,
      point: 0,
      lines: 1,
      line: 1,
      triangles: 4,
      triangle: 4,
      "line loop": 2,
      "line strip": 3,
      "triangle strip": 5,
      "triangle fan": 6,
    },
    jb = new Float32Array(1),
    Db = new Uint32Array(jb.buffer),
    Hb = [9984, 9986, 9985, 9987],
    Ka = [0, 6409, 6410, 6407, 6408],
    R = {};
  R[6409] = R[6406] = R[6402] = 1;
  R[34041] = R[6410] = 2;
  R[6407] = R[35904] = 3;
  R[6408] = R[35906] = 4;
  var Eb = Object.keys(Ea).concat([
      "[object HTMLCanvasElement]",
      "[object CanvasRenderingContext2D]",
      "[object HTMLImageElement]",
      "[object HTMLVideoElement]",
    ]),
    za = [];
  za[5121] = 1;
  za[5126] = 4;
  za[36193] = 2;
  za[5123] = 2;
  za[5125] = 4;
  var C = [];
  C[32854] = 2;
  C[32855] = 2;
  C[36194] = 2;
  C[34041] = 4;
  C[33776] = 0.5;
  C[33777] = 0.5;
  C[33778] = 1;
  C[33779] = 1;
  C[35986] = 0.5;
  C[35987] = 1;
  C[34798] = 1;
  C[35840] = 0.5;
  C[35841] = 0.25;
  C[35842] = 0.5;
  C[35843] = 0.25;
  C[36196] = 0.5;
  var L = [];
  L[32854] = 2;
  L[32855] = 2;
  L[36194] = 2;
  L[33189] = 2;
  L[36168] = 1;
  L[34041] = 4;
  L[35907] = 4;
  L[34836] = 16;
  L[34842] = 8;
  L[34843] = 6;
  var Rb = function (a, b, c, d, f) {
      function k(a) {
        this.id = r++;
        this.refCount = 1;
        this.renderbuffer = a;
        this.format = 32854;
        this.height = this.width = 0;
        f.profile && (this.stats = { size: 0 });
      }
      function p(b) {
        var c = b.renderbuffer;
        a.bindRenderbuffer(36161, null);
        a.deleteRenderbuffer(c);
        b.renderbuffer = null;
        b.refCount = 0;
        delete v[b.id];
        d.renderbufferCount--;
      }
      var h = {
        rgba4: 32854,
        rgb565: 36194,
        "rgb5 a1": 32855,
        depth: 33189,
        stencil: 36168,
        "depth stencil": 34041,
      };
      b.ext_srgb && (h.srgba = 35907);
      b.ext_color_buffer_half_float &&
        ((h.rgba16f = 34842), (h.rgb16f = 34843));
      b.webgl_color_buffer_float && (h.rgba32f = 34836);
      var g = [];
      Object.keys(h).forEach(function (a) {
        g[h[a]] = a;
      });
      var r = 0,
        v = {};
      k.prototype.decRef = function () {
        0 >= --this.refCount && p(this);
      };
      f.profile &&
        (d.getTotalRenderbufferSize = function () {
          var a = 0;
          Object.keys(v).forEach(function (b) {
            a += v[b].stats.size;
          });
          return a;
        });
      return {
        create: function (b, c) {
          function m(b, c) {
            var d = 0,
              l = 0,
              k = 32854;
            "object" === typeof b && b
              ? ("shape" in b
                  ? ((l = b.shape), (d = l[0] | 0), (l = l[1] | 0))
                  : ("radius" in b && (d = l = b.radius | 0),
                    "width" in b && (d = b.width | 0),
                    "height" in b && (l = b.height | 0)),
                "format" in b && (k = h[b.format]))
              : "number" === typeof b
                ? ((d = b | 0), (l = "number" === typeof c ? c | 0 : d))
                : b || (d = l = 1);
            if (d !== e.width || l !== e.height || k !== e.format)
              return (
                (m.width = e.width = d),
                (m.height = e.height = l),
                (e.format = k),
                a.bindRenderbuffer(36161, e.renderbuffer),
                a.renderbufferStorage(36161, k, d, l),
                f.profile && (e.stats.size = L[e.format] * e.width * e.height),
                (m.format = g[e.format]),
                m
              );
          }
          var e = new k(a.createRenderbuffer());
          v[e.id] = e;
          d.renderbufferCount++;
          m(b, c);
          m.resize = function (b, c) {
            var d = b | 0,
              g = c | 0 || d;
            if (d === e.width && g === e.height) return m;
            m.width = e.width = d;
            m.height = e.height = g;
            a.bindRenderbuffer(36161, e.renderbuffer);
            a.renderbufferStorage(36161, e.format, d, g);
            f.profile && (e.stats.size = L[e.format] * e.width * e.height);
            return m;
          };
          m._reglType = "renderbuffer";
          m._renderbuffer = e;
          f.profile && (m.stats = e.stats);
          m.destroy = function () {
            e.decRef();
          };
          return m;
        },
        clear: function () {
          H(v).forEach(p);
        },
        restore: function () {
          H(v).forEach(function (b) {
            b.renderbuffer = a.createRenderbuffer();
            a.bindRenderbuffer(36161, b.renderbuffer);
            a.renderbufferStorage(36161, b.format, b.width, b.height);
          });
          a.bindRenderbuffer(36161, null);
        },
      };
    },
    ob = [];
  ob[6408] = 4;
  var Ma = [];
  Ma[5121] = 1;
  Ma[5126] = 4;
  Ma[36193] = 2;
  var Da = ["x", "y", "z", "w"],
    Pb =
      "blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(
        " ",
      ),
    Ga = {
      0: 0,
      1: 1,
      zero: 0,
      one: 1,
      "src color": 768,
      "one minus src color": 769,
      "src alpha": 770,
      "one minus src alpha": 771,
      "dst color": 774,
      "one minus dst color": 775,
      "dst alpha": 772,
      "one minus dst alpha": 773,
      "constant color": 32769,
      "one minus constant color": 32770,
      "constant alpha": 32771,
      "one minus constant alpha": 32772,
      "src alpha saturate": 776,
    },
    Ua = {
      never: 512,
      less: 513,
      "<": 513,
      equal: 514,
      "=": 514,
      "==": 514,
      "===": 514,
      lequal: 515,
      "<=": 515,
      greater: 516,
      ">": 516,
      notequal: 517,
      "!=": 517,
      "!==": 517,
      gequal: 518,
      ">=": 518,
      always: 519,
    },
    Oa = {
      0: 0,
      zero: 0,
      keep: 7680,
      replace: 7681,
      increment: 7682,
      decrement: 7683,
      "increment wrap": 34055,
      "decrement wrap": 34056,
      invert: 5386,
    },
    rb = { cw: 2304, ccw: 2305 },
    sb = new Y(!1, !1, !1, function () {}),
    Sb = function (a, b) {
      function c() {
        this.endQueryIndex = this.startQueryIndex = -1;
        this.sum = 0;
        this.stats = null;
      }
      function d(a, b, d) {
        var e = h.pop() || new c();
        e.startQueryIndex = a;
        e.endQueryIndex = b;
        e.sum = 0;
        e.stats = d;
        g.push(e);
      }
      var f = b.ext_disjoint_timer_query;
      if (!f) return null;
      var k = [],
        p = [],
        h = [],
        g = [],
        r = [],
        v = [];
      return {
        beginQuery: function (a) {
          var b = k.pop() || f.createQueryEXT();
          f.beginQueryEXT(35007, b);
          p.push(b);
          d(p.length - 1, p.length, a);
        },
        endQuery: function () {
          f.endQueryEXT(35007);
        },
        pushScopeStats: d,
        update: function () {
          var a, b;
          a = p.length;
          if (0 !== a) {
            v.length = Math.max(v.length, a + 1);
            r.length = Math.max(r.length, a + 1);
            r[0] = 0;
            var c = (v[0] = 0);
            for (b = a = 0; b < p.length; ++b) {
              var e = p[b];
              f.getQueryObjectEXT(e, 34919)
                ? ((c += f.getQueryObjectEXT(e, 34918)), k.push(e))
                : (p[a++] = e);
              r[b + 1] = c;
              v[b + 1] = a;
            }
            p.length = a;
            for (b = a = 0; b < g.length; ++b) {
              var c = g[b],
                d = c.startQueryIndex,
                e = c.endQueryIndex;
              c.sum += r[e] - r[d];
              d = v[d];
              e = v[e];
              e === d
                ? ((c.stats.gpuTime += c.sum / 1e6), h.push(c))
                : ((c.startQueryIndex = d),
                  (c.endQueryIndex = e),
                  (g[a++] = c));
            }
            g.length = a;
          }
        },
        getNumPendingQueries: function () {
          return p.length;
        },
        clear: function () {
          k.push.apply(k, p);
          for (var a = 0; a < k.length; a++) f.deleteQueryEXT(k[a]);
          p.length = 0;
          k.length = 0;
        },
        restore: function () {
          p.length = 0;
          k.length = 0;
        },
      };
    };
  return function (a) {
    function b() {
      if (0 === E.length) x && x.update(), (ba = null);
      else {
        ba = Va.next(b);
        v();
        for (var a = E.length - 1; 0 <= a; --a) {
          var c = E[a];
          c && c(M, null, 0);
        }
        m.flush();
        x && x.update();
      }
    }
    function c() {
      !ba && 0 < E.length && (ba = Va.next(b));
    }
    function d() {
      ba && (Va.cancel(b), (ba = null));
    }
    function f(a) {
      a.preventDefault();
      d();
      S.forEach(function (a) {
        a();
      });
    }
    function k(a) {
      m.getError();
      n.restore();
      N.restore();
      G.restore();
      z.restore();
      L.restore();
      I.restore();
      x && x.restore();
      T.procs.refresh();
      c();
      U.forEach(function (a) {
        a();
      });
    }
    function p(a) {
      function b(a) {
        var c = {},
          d = {};
        Object.keys(a).forEach(function (b) {
          var e = a[b];
          ia.isDynamic(e) ? (d[b] = ia.unbox(e, b)) : (c[b] = e);
        });
        return { dynamic: d, static: c };
      }
      function c(a) {
        for (; m.length < a; ) m.push(null);
        return m;
      }
      var d = b(a.context || {}),
        e = b(a.uniforms || {}),
        f = b(a.attributes || {}),
        g = b(
          (function (a) {
            function b(a) {
              if (a in c) {
                var d = c[a];
                delete c[a];
                Object.keys(d).forEach(function (b) {
                  c[a + "." + b] = d[b];
                });
              }
            }
            var c = A({}, a);
            delete c.uniforms;
            delete c.attributes;
            delete c.context;
            "stencil" in c &&
              c.stencil.op &&
              ((c.stencil.opBack = c.stencil.opFront = c.stencil.op),
              delete c.stencil.op);
            b("blend");
            b("depth");
            b("cull");
            b("stencil");
            b("polygonOffset");
            b("scissor");
            b("sample");
            return c;
          })(a),
        );
      a = { gpuTime: 0, cpuTime: 0, count: 0 };
      var d = T.compile(g, f, e, d, a),
        h = d.draw,
        k = d.batch,
        l = d.scope,
        m = [];
      return A(
        function (a, b) {
          var d;
          if ("function" === typeof a) return l.call(this, null, a, 0);
          if ("function" === typeof b)
            if ("number" === typeof a)
              for (d = 0; d < a; ++d) l.call(this, null, b, d);
            else if (Array.isArray(a))
              for (d = 0; d < a.length; ++d) l.call(this, a[d], b, d);
            else return l.call(this, a, b, 0);
          else if ("number" === typeof a) {
            if (0 < a) return k.call(this, c(a | 0), a | 0);
          } else if (Array.isArray(a)) {
            if (a.length) return k.call(this, a, a.length);
          } else return h.call(this, a);
        },
        { stats: a },
      );
    }
    function h(a, b) {
      var c = 0;
      T.procs.poll();
      var d = b.color;
      d &&
        (m.clearColor(+d[0] || 0, +d[1] || 0, +d[2] || 0, +d[3] || 0),
        (c |= 16384));
      "depth" in b && (m.clearDepth(+b.depth), (c |= 256));
      "stencil" in b && (m.clearStencil(b.stencil | 0), (c |= 1024));
      m.clear(c);
    }
    function g(a) {
      E.push(a);
      c();
      return {
        cancel: function () {
          function b() {
            var a = tb(E, b);
            E[a] = E[E.length - 1];
            --E.length;
            0 >= E.length && d();
          }
          var c = tb(E, a);
          E[c] = b;
        },
      };
    }
    function r() {
      var a = O.viewport,
        b = O.scissor_box;
      a[0] = a[1] = b[0] = b[1] = 0;
      M.viewportWidth =
        M.framebufferWidth =
        M.drawingBufferWidth =
        a[2] =
        b[2] =
          m.drawingBufferWidth;
      M.viewportHeight =
        M.framebufferHeight =
        M.drawingBufferHeight =
        a[3] =
        b[3] =
          m.drawingBufferHeight;
    }
    function v() {
      M.tick += 1;
      M.time = u();
      r();
      T.procs.poll();
    }
    function l() {
      r();
      T.procs.refresh();
      x && x.update();
    }
    function u() {
      return (ub() - C) / 1e3;
    }
    a = zb(a);
    if (!a) return null;
    var m = a.gl,
      e = m.getContextAttributes();
    m.isContextLost();
    var n = Ab(m, a);
    if (!n) return null;
    var D = wb(),
      w = {
        bufferCount: 0,
        elementsCount: 0,
        framebufferCount: 0,
        shaderCount: 0,
        textureCount: 0,
        cubeCount: 0,
        renderbufferCount: 0,
        maxTextureUnits: 0,
      },
      t = n.extensions,
      x = Sb(m, t),
      C = ub(),
      B = m.drawingBufferWidth,
      J = m.drawingBufferHeight,
      M = {
        tick: 0,
        time: 0,
        viewportWidth: B,
        viewportHeight: J,
        framebufferWidth: B,
        framebufferHeight: J,
        drawingBufferWidth: B,
        drawingBufferHeight: J,
        pixelRatio: a.pixelRatio,
      },
      P = Qb(m, t),
      G = Bb(m, w, a),
      Q = Cb(m, t, G, w),
      B = Kb(m, t, P, G, D),
      N = Lb(m, D, w, a),
      z = Fb(
        m,
        t,
        P,
        function () {
          T.procs.poll();
        },
        M,
        w,
        a,
      ),
      L = Rb(m, t, P, w, a),
      I = Jb(m, t, P, z, L, w),
      T = Ob(
        m,
        D,
        t,
        P,
        G,
        Q,
        z,
        I,
        {},
        B,
        N,
        { elements: null, primitive: 4, count: -1, offset: 0, instances: -1 },
        M,
        x,
        a,
      ),
      D = Mb(m, I, T.procs.poll, M, e, t),
      O = T.next,
      H = m.canvas,
      E = [],
      S = [],
      U = [],
      R = [a.onDestroy],
      ba = null;
    H &&
      (H.addEventListener("webglcontextlost", f, !1),
      H.addEventListener("webglcontextrestored", k, !1));
    var Y = (I.setFBO = p({
      framebuffer: ia.define.call(null, 1, "framebuffer"),
    }));
    l();
    e = A(p, {
      clear: function (a) {
        if ("framebuffer" in a)
          if (a.framebuffer && "framebufferCube" === a.framebuffer_reglType)
            for (var b = 0; 6 > b; ++b)
              Y(A({ framebuffer: a.framebuffer.faces[b] }, a), h);
          else Y(a, h);
        else h(null, a);
      },
      prop: ia.define.bind(null, 1),
      context: ia.define.bind(null, 2),
      this: ia.define.bind(null, 3),
      draw: p({}),
      buffer: function (a) {
        return G.create(a, 34962, !1, !1);
      },
      elements: function (a) {
        return Q.create(a, !1);
      },
      texture: z.create2D,
      cube: z.createCube,
      renderbuffer: L.create,
      framebuffer: I.create,
      framebufferCube: I.createCube,
      attributes: e,
      frame: g,
      on: function (a, b) {
        var c;
        switch (a) {
          case "frame":
            return g(b);
          case "lost":
            c = S;
            break;
          case "restore":
            c = U;
            break;
          case "destroy":
            c = R;
        }
        c.push(b);
        return {
          cancel: function () {
            for (var a = 0; a < c.length; ++a)
              if (c[a] === b) {
                c[a] = c[c.length - 1];
                c.pop();
                break;
              }
          },
        };
      },
      limits: P,
      hasExtension: function (a) {
        return 0 <= P.extensions.indexOf(a.toLowerCase());
      },
      read: D,
      destroy: function () {
        E.length = 0;
        d();
        H &&
          (H.removeEventListener("webglcontextlost", f),
          H.removeEventListener("webglcontextrestored", k));
        N.clear();
        I.clear();
        L.clear();
        z.clear();
        Q.clear();
        G.clear();
        x && x.clear();
        R.forEach(function (a) {
          a();
        });
      },
      _gl: m,
      _refresh: l,
      poll: function () {
        v();
        x && x.update();
      },
      now: u,
      stats: w,
    });
    a.onDone(null, e);
    return e;
  };
});
